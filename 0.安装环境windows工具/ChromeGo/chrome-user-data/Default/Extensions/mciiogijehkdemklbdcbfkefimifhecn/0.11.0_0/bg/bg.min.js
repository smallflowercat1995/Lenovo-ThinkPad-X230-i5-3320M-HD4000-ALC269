'use strict';function _DYTask_(a){a?(this.id=a.id,this.cr_id=a.cr_id,this.url=a.url,this.referer=a.referer,this.page_title=a.page_title,this.text=a.text,this.title=a.title,this.size=a.size,void 0==this.size&&(this.size=-1),this.iconURL16=a.iconURL16,this.iconURL32=a.iconURL32,this.folder=a.folder,this.naming=a.naming,this.naming_auto=a.naming_auto,this.folder_auto=a.folder_auto,this.name_conflict=a.name_conflict,this.state=a.state,this.time_add=new Date(a.time_add),this.time_finish=a.time_finish?
new Date(a.time_finish):null,this.time_elapsed=a.time_elapsed,this.max_threads_config=a.max_threads_config,this.checksum=a.checksum,this.desc=a.desc,this.batch_num=a.batch_num,this.exists=a.exists,this._start_time=a._start_time,this.hash=a.hash,this.temp_file=a.temp_file,this.recycled=a.recycled,this.blocksize=a.blocksize,this.blockcnt=a.blockcnt,this.finished_blocks=a.finished_blocks,this.finished_bytes=a.finished_bytes,this.etag=a.etag,this.last_modified=a.last_modified,this.mime_type=a.mime_type,
this.file_ext=a.file_ext,this.full_path=a.full_path,this.eurl=a.eurl,this.single_thread=a.single_thread,this.error_str=a.error_str):(this.id=-1,this.cr_id=-2,this.title=this.text=this.page_title=this.referer=this.url="",this.size=-1,this.naming=this.folder=this.iconURL32=this.iconURL16="",this.naming_auto=!0,this.folder_auto=!1,this.name_conflict="",this.state=2,this.time_add=new Date,this.time_finish=null,this.time_elapsed=0,this.max_threads_config=5,this.desc=this.checksum="",this.batch_num=0,this.exists=
!1,this.temp_file=this.hash="",this.recycled=!1,this.finished_bytes=this.finished_blocks=this.blockcnt=this.blocksize=0,this.eurl=this.full_path=this.file_ext=this.mime_type=this.last_modified=this.etag="",this.single_thread=!0);0<this.size?(0<this.blocksize&&(this.finished_bytes=Math.min(this.size,this.blocksize*this.finished_blocks)),this.progress=this.finished_bytes/this.size*100):this.progress=3==this.state?100:0;this.time_remained=this.active_threads=this.max_threads=this.speed=0;this._cf={}}
;

'use strict';function ba(a){var b=0,l=0,e=[];a&&(b=a,l=Math.ceil(a/32))&&(e=new Uint32Array(Array(l)),(a%=32)&&(e[l-1]|=~((1<<a)-1)));a={qc:function(){return b},pc:function(){var q=0;if(e&&l)for(var n=0;n<l;++n){var v=e[n];v=v-(v>>>1&3681400539)-(v>>>2&1227133513);v=v+(v>>>3)&3340530119;q+=((v&2147483647)%63+((v&2147483648)>>>30))%63}return q-(32*l-b)},resize:function(q){b=q;e=[];if(l=Math.ceil(q/32))e=new Uint32Array(Array(l)),(q%=32)&&(e[l-1]|=~((1<<q)-1))},reset:function(){if(e&&l){for(var q=0;q<
l;++q)e[q]=0;(q=b%32)&&(e[l-1]|=~((1<<q)-1))}},complete:function(){if(e&&l)for(var q=0;q<l;++q)e[q]=4294967295},set:function(q,n){if(void 0==n)n=1;else if(0==n)return;n=q+n;n>b&&(n=b);for(var v,y,u=0;0<=q&&q<n;)v=Math.floor(q/32),y=q%32,0==(e[v]&1<<y)&&++u,e[v]|=1<<y,++q;return u},get:function(q){return 0<=q&&q<b?0==(e[Math.floor(q/32)]&1<<q%32)?0:1:0},clear:function(q){0<=q&&q<b&&(e[Math.floor(q/32)]&=~(1<<q%32))},Eb:function(q){if(e&&l)for(var n=0,v=0;v<l;++v)for(var y=0;32>y&&n<b;++y,++n)0!=(e[v]&
1<<y)&&q(n)},Ea:function(q){if(!b)return-1;for(var n=0,v;n<l&&65535==(e[n]&65535)&&65535==(e[n]>>16&65535);)++n;if(n==l)return-1;var y=e[n];for(v=0;y&1;)++v,y>>=1;q&&(e[n]|=1<<v);return 32*n+v}};a.set=a.set;return a};window._gaq=window._gaq||[];window._gaq.push(["_setAccount","UA-32450437-3"],["_setDetectFlash",!1],["_setDetectTitle",!1],["_trackPageview"]);const ca={ss:300,dz:250,fe_us:150,sf:150,sets:100,stats:50},ea={sets:5,stats:5},fa={sets:{da:0,aa:0},stats:{da:0,aa:0}};function ha(a,b){if(b){var l=ca[a[1]];l&&Math.floor(4E3*Math.random()*b)<l&&(a[1]+=`[${l}][1:${4}]`,a[2]+=`[1:${b}]`,window._gaq.push(a))}}
function ia(a){const b=ea.sets;if(b){var l=fa.sets;if(l){var e=Date.now();864E5<e-(l.aa||0)&&(l.aa=e,l.da=0);l.da++>=b||ha(["_trackEvent","sets",a,"add",void 0,void 0],b)}}}function ka(a){const b=a.length;a.forEach(function(l){for(l.unshift("_trackEvent","ss");5>l.length;)l.push(void 0);l.push(!0);ha(l,b)})}
window.addEventListener("load",function(){if(1==window._ga_ssl_with_xhr_chrono_){var a=new XMLHttpRequest;a.open("GET","https://ssl.google-analytics.com/ga.js",!0);a.onreadystatechange=function(){if(4==a.readyState&&200==a.status)try{eval((a.responseText||"").replace("http://www.google-analytics.com","https://ssl.google-analytics.com"))}catch(l){console.log(l)}};a.send()}else{var b=document.createElement("script");b.type="text/javascript";b.async=!0;b.src="https://ssl.google-analytics.com/ga.js";
document.body.appendChild(b)}});var la=localStorage;var g=chrome.i18n.getMessage,t=chrome.runtime.sendMessage;function ma(a){chrome.tabs.create({url:"chrome://settings/downloads"});na("fe_us","change_downloads_folder",a)}const oa=/^(C:\/Windows\/|C:\/ProgramData\/|C:\/Program Files\/|C:\/Program Files \(x86\)\/|C:\/Users\/[^/]+\/AppData\/)/i,pa=/^\/(Users|home|tmp)\//i;function qa(a){return 0==navigator.platform.indexOf("Win")?a&&!oa.test(a):a&&pa.test(a)}function ra(a){return a?a.trim():""}
function ta(a,b){return a&&b&&a.startsWith(b)?a.slice(b.length):a}
var ua=/^data:([^;]+)((?:;[^=]+=[^;]+)*)(?:;(base64))?,(.+)$/,va=/^(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i,wa=
/^(data:|(https?|ftp):\/\/)/,xa={"3gpp":"3gp","3gpp2":"3g2",aiff:"aif","ms-asf":"asf",basic:"au",msvideo:"avi",binary:"bin",macbinary:"bin","octet-stream":"bin","windows-bmp":"bmp",bzip:"bz",bzip2:"bz2",java:"class","java-class":"class",msword:"doc","openxmlformats-officedocument.wordprocessingml.document":"docx",fortran:"f",icon:"ico","java-source":"java",jpeg:"jpg",pjpeg:"jpg",mpegurl:"m3u",rfc822:"mhtml",matroska:"mkv",quicktime:"mov",mpeg3:"mp3",mpeg:"mp4","sgi-movie":"mv",pascal:"p","portable-bitmap":"pbm",
"portable-floatmap":"pfm","portable-graymap":"pgm","portable-pixmap":"ppm",mspowerpoint:"ppt","ms-powerpoint":"ppt",powerpoint:"ppt","openxmlformats-officedocument.presentationml.presentation":"pptx","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"ppsx",postscript:"ps","adobe.photoshop":"psd","script.phyton":"py","pn-realaudio":"ra","rn-realmedia":"rm",bsh:"sh","svg+xml":"svg",gnutar:"tgz",plain:"txt","ms-wma":"wma","ms-wmv":"wmv",excel:"xls",msexcel:"xls","ms-excel":"xls",
"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx",compressed:"zip","zip-compressed":"zip"};
function ya(a){a=(a||"").trim();var b={},l=14;if(0==a.indexOf("data:")){for(;l--;)b[za[l]]="";b.protocol="data";(a=ua.exec(a))&&a[1]&&(a=a[1].match(/(?:[^\/]+)\/(?:x-)?(?:vnd\.)?(.+)/i))&&a[1]&&(b.file="download."+(xa[a[1]]||a[1]))}else try{const p=new URL(a);{var e=p.pathname;const h=e.lastIndexOf(".");if(-1==h||h==e.length-1)var q="";else{var n=e.lastIndexOf("/");q=n>h?"":e.slice(n+1)}}{var v=p.pathname;const h=v.lastIndexOf(".");if(-1==h||h==v.length-1)var y=v;else{var u=v.lastIndexOf("/");y=u>
h?v:v.substring(0,u+1)}}return{anchor:ta(p.hash,"#"),authority:p.host,directory:y,file:q,host:p.host,password:p.password,path:p.pathname,port:p.port,protocol:p.protocol,query:ta(p.search,"?"),relative:p.pathname,source:p.href,user:p.username,userInfo:p.username&&p.password?p.username+":"+p.password:p.username}}catch(p){for(console.error(p);l--;)b[za[l]]=""}return b}var za="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");
function Aa(a){a=(a||"").trim();var b=a.lastIndexOf("."),l=-1!=b;l||(b=a.length);return{R:a.substr(0,b),v:a.substr(b+1),tc:l}}function Ba(a){return wa.test(a)?a:"http://"+a}function Ca(a){return(a||"").trim().replace(/(^(\\|\/|\.)+)|((\\|\/|\.)+$)/g,"").replace(/\s*(\\|\/)+\s*/g,"/").trim()}function Da(a,b){return a.replace(/[\/\\]+$/g,"").replace(/[\/\\]+/g,"/").trim()+(0==b?"":"/")}function Ea(a,b){return a?b?a.replace(/[\/\\]+$/,"")+"/"+b.replace(/[\/\\]+$/,""):a:b}
function Fa(a){let b=0;"/"==a[a.length-1]&&(b=1);let l=a.lastIndexOf("/",a.length-1-b)+1;return[a.substring(0,l),a.substring(l,Math.max(l,a.length-b))]}function Ga(a){return a?a.substr(Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))+1):""}function Ha(a){return a?a.substr(0,Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))+1):""}function Ia(a){return a&&!/^ *(\.|\\|\/)/.test(a)&&""!=a.replace(/[\.\*\\\/_]/g,"").trim()}
function Ja(a){a=Math.round(a);if(60>a)var b="Second";else 3600>a?(a=Math.round(a/60),b="Minute"):86400>a?(a=Math.round(a/3600),b="Hour"):(a=Math.round(a/86400),b="Day");1<a&&(b+="s");return g("unit"+b,[a.toString()])}function Ka(a){return 1E3>a?+a.toFixed(2)+" B":1024E3>a?+(a/1024).toFixed(2)+" KB":1048576E3>a?+(a/1048576).toFixed(2)+" MB":+(a/1073741824).toFixed(2)+" GB"}function La(a){return 0>a?g("phraseUnknown"):Ka(a)+"/s"}var w=0;w=0;var Ma=w++,Na=w++,Oa=w++;w=0;
var J=w++,Ra=w++,Sa=w++,Ta=w-1,L=w++,P=w++;w++;w=0;var Ua=w++,Va=w++;w=0;var Wa=w++;w++;var Xa=w++,Ya=w++;w=0;var Za=w++,$a=w++;w++;w=0;var ab=w++;w++;w++;var bb=w++,cb=w++;w=0;var db=w++,eb=w++;w=0;w++;w++;var fb=w++;w=0;w++;w++;w++;w++;w++;w++;w++;w++;w++;w++;w++;w++;w++;w++;w++;w=0;w++;w++;w++;w=0;w++;w=256;var gb=w++;w++;w++;w++;w++;w++;w=512;w++;w++;var hb="dy_proxy_enable dy_proxy dy_max_con_tasks dy_retry_count dy_retry_timeout dy_cache_max dy_cache_unit dy_bandlimit dy_file_permission".split(" ");
const ib=g("chromesysFailedGenericNetworkError"),jb=g("chromesysFailedGenericDownloadError");g("stateDownloading");g("stateQueue");g("statePaused");g("stateFinished");g("stateError");g("stateFileMiss");var kb={none:g("errorNone"),fnConflict:g("errorFNameConflict"),noID:g("errorNoID"),NETWORK_FAILED:ib,NETWORK_DISCONNECTED:ib,NETWORK_SERVER_DOWN:ib,NETWORK_INVALID_REQUEST:ib,FILE_FAILED:jb,FILE_HASH_MISMATCH:jb,SERVER_NO_RANGE:jb};function lb(a){return a?kb[a]||g("chromesysFailed_"+a)||a:""};const mb=["",[String.fromCharCode(103),String.fromCharCode(108),String.fromCharCode(99)].join(""),"1_"].join("_");function nb(a){var b=void 0;a=la[mb+a];if(void 0!=a)try{b=JSON.parse(atob(a[1]+a.substr(3)))}catch(l){}return b}function ob(a){a=nb(a);var b=Date.now();return!a||!a._t||isNaN(a._t)||!isFinite(a._t)||6048E5<b-a._t?{_t:b}:a}
function na(a,b,l,e){function q(v){return btoa(v.split("").map(y=>{var u=y.charCodeAt(0),p=0;"_"!=y&&(p=60<u?-55:53);return String.fromCharCode(u+p)}).join(""))}e=e||1;var n=ob(a);b=q(b)+(l?";"+q(l):"");n[b]=(n[b]||0)+e;(function(v,y){y=btoa(JSON.stringify(y));la[mb+v]=String.fromCharCode(97+Math.floor(26*Math.random()))+y[0]+String.fromCharCode(97+Math.floor(26*Math.random()))+y.substr(1)})(a,n)}
function qb(a){if(!(0>=a)){var b=Math.round(Math.log2(a));na("dz","sz",10>b?(1<<b)+"B":20>b?(1<<b-10)+"KB":30>b?(1<<b-20)+"MB":(1<<b-30)+"GB");na("dz","sz_raw","",a)}};var rb,sb=!!window.Pa&&!!window.Pa.kc||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),tb="undefined"!==typeof InstallTrigger,ub=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!==typeof safari&&safari.wc).toString(),vb=!!document.documentMode,wb=!vb&&!!window.mc;rb=sb?"OPERA":tb?"FF":ub?"SAFARI":vb?"IE":wb?"EDGE":"CHROME";var xb="FF"==rb?"about:preferences#general":"chrome://settings/languages";var R=_DYTask_;
R.prototype.reset=function(a,b){this.naming_auto&&(this.naming="");this.name_conflict="";this.eurl=this.url;this.cr_id=-2;this.size=-1;this.iconURL32=this.iconURL16="";void 0!=a&&(this.state=a);this.time_finish=null;this.batch_num=this.time_elapsed=0;this.exists=!1;this.hash="";this._start_time=void 0;this.temp_file="";this.recycled=!1;this.finished_bytes=this.finished_blocks=this.blockcnt=this.blocksize=0;this.full_path=this.mime_type=this.last_modified=this.etag="";this.single_thread=!0;this.error_str=
void 0;this.time_remained=this.active_threads=this.max_threads=this.speed=this.progress=0;0!=b&&(this.time_add=new Date);yb(this);this._cf={};delete this.Y;delete this.G;delete this.na;delete this.m};function yb(a){a.ma=void 0;a.D=void 0}
(function(){function a(e,q,n,v,y){if("mime"==q)q="mime_type";else if("addtime"==q)q="time_add";else if("refer"==q)q="referer";else if("remark"==q||"remarks"==q)q="desc";var u=null;switch(q){case "host":u=n.host;break;case "query":case "anchor":u=n[q];break;case "subdirs":u=n.directory;break;case "name":u=v?decodeURIComponent(v.R):"";break;case "ext":u=v?v.v:"";break;case "url":u=e.url;break;case "eurl":u=e.eurl;break;case "num":return e.batch_num||(e.batch_num=l++),e.batch_num;case "date":case "datetime":u=
new Date;break;case "state":case "size":case "referer":case "page_title":case "text":case "title":case "time_add":case "time_elapsed":case "checksum":case "desc":case "progress":case "finished_bytes":case "mime_type":u=e[q];break;default:1==y&&(u="_"+q+"_")}return u}function b(e,q,n){function v(h){return 10>h?"0"+h:h.toString()}function y(h,B){var H={"M+":h.getMonth()+1,"d+":h.getDate(),"h+":h.getHours(),"m+":h.getMinutes(),"s+":h.getSeconds(),S:h.getMilliseconds()};B||(B="yyyy-MM-dd hh:mm:ss");/(y+)/.test(B)&&
(B=B.replace(RegExp.$1,(h.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in H)(new RegExp("("+r+")")).test(B)&&(B=B.replace(RegExp.$1,1==RegExp.$1.length?H[r]:("00"+H[r]).substr((""+H[r]).length)));return B}q=(q||"").trim();if(!q)return"";var u=ya(e.url),p=Aa(e.file_ext||(e.eurl!=e.url?ya(e.eurl).file:"")||u.file);q=q.replace(/\*(flat)?([^\*]+)?\*/gi,function(h,B,H){if(H){var r=ra(H.replace(/\s+,\s+/,",")).split(",");h="";H=r[0];r=r[1];var C=new Date;switch(H){case "hh":h=v(C.getHours());
break;case "mm":h=v(C.getMinutes());break;case "ss":h=v(C.getSeconds());break;case "y":h=C.getFullYear().toString();break;case "m":h=v(C.getMonth()+1);break;case "d":h=v(C.getDate());break;case "wd":h=""+C.getDay();break;case "datetime":h=y(C,r);break;case "date":h=y(C,r||"yyyy-MM-dd");break;case "time":h=y(C,r||"hh:mm:ss");break;case "time_add":case "addtime":h=y(e.time_add,r);break;case "size_s":h=Ka(e.size);break;default:"state"!=H&&"progress"!=H&&"finished_bytes"!=H&&"time_elapsed"!=H?h=a(e,H,
u,p,!0):h="_"+H+"_"}(h=h||"")&&(B||n)&&(h=(h||"").replace(/\/|\\/g,"_"));return h}return""});return Ca(q.replace(/~|\*|\?|:|\||<|>|"/g,"_"))}var l=1;R.prototype.tb=function(e){var q=ya(this.url),n=Aa(this.file_ext||(this.eurl!=this.url?ya(this.eurl).file:"")||q.file);e=a(this,e,q,n);if(void 0==e||null==e)e="";return e};R.prototype.Aa=function(){return Ga(this.full_path)||this.file_ext||ya(this.url).file};R.prototype.ab=function(){return b(this,this.naming)};R.prototype.s=function(){return Ga(this.full_path)||
this.ma||(this.ma=Ga(this.Rb()))};R.prototype.Rb=function(){if(this.D)return this.D;for(var e={},q=[this.naming,T.get("def_naming"),"*name*.*ext*","*subdirs*","*anchor*","*query*","*host*"],n=0,v=q.length;n<v;++n){var y=q[n];if(y&&!e[y]&&(e[y]=!0,this.D=b(this,y,2<=n),Ia(this.D)))return this.D}return this.D="_file"}})();R.prototype.reset=R.prototype.reset;R.prototype.get_raw_name=R.prototype.Aa;R.prototype.render_UI_name=R.prototype.s;function zb(a,b){return(-1<navigator.platform.indexOf("Mac")?((b||"")&&"\u21e7")+"\u2318":"Ctrl+")+a}
var Ab={general:{name:g("titleOptionsGeneral"),sections:[{name:"CHROME"==rb?"Chrome":g("chromesysBrowser"),id:"gen-chrome",items:["override_cr","hide_cr_bar"]},{name:g("optSectionTaskDefaults"),id:"gen-new-task-def",tip:g("tipOptSectionTaskDefaults"),items:["always_use_last_location","def_addtop","def_addpause"]},{name:g("optSectionOneClick"),id:"gen-one-click",items:["doneclick_rule"]},{name:g("optSectionNetwork"),id:"gen-network",items:["dy_max_con_tasks","dy_max_per_server"]},{name:g("optSectionMisc"),
id:"gen-misc",items:["fnconflict","folder_inaccessible","down_clipboard","clear_search","recycle_cancel"]}]},"interface":{name:g("titleOptionsInterface"),sections:[{name:g("chromesysLanguageSection"),id:"int-language",description:g("msgChromeI18nLanguage")+(g("uilang").substr(0,2).toLowerCase()!=chrome.i18n.getUILanguage().substr(0,2).toLowerCase()?"<br>Oops, Chrono is not yet available in "+(g("uilangName")||"your language")+', please help us with <a target=_blank href="http://translate.chronodownloader.net">translation</a> :)':
""),items:["_uilanguage"]},{name:g("optSectionBehaviors"),id:"int-behaviors",items:["start_interrupted","slide_details_panel","dbclick_action"]},{name:g("optSectionMenu"),id:"int-menu",items:["menu_d_dialog","menu_d_oneclick"]},{name:g("optSectionPopup"),id:"int-popup",items:["poplist_showd_first","poplist_clear_close","poplist_max_items","poplist_remove_confirm"]},{name:g("optSectionPreview"),id:"int-preview",items:["preview_autoplay"]},{name:g("optSectionNotifications"),id:"int-notifications",items:"OPERA"==
rb?"notify_oneclick notify_finish notify_error sound_finish sound_error click_notify".split(" "):"notify_oneclick notify_finish notify_error sound_finish sound_error notify_progress notify_large_preview click_notify".split(" ")},{name:g("optSectionMisc"),id:"int-misc",items:["badge_downnum","font_size"]}]},rules:{name:g("titleOptionsRules"),sections:[{items:["match_mode","def_naming"]}]}},Bb={label:"",type:"button",buttonText:g("chromesysChange"),onclick:function(){chrome.tabs.create({url:xb})}},
Cb={label:"When file name conflicts",type:"select",options:[g("optOptionUniquify"),g("optOptionOverwrite"),g("optOptionPrompt"),g("optOptionSkipPause"),g("optOptionSkipCancel")],value:ab,b:"NameConflict"},Db={label:g("fieldThreads"),type:"int",native_only:!0,value:5,min:1,max:15},Eb={label:g("optionAddTop"),type:"bool",value:!1},Fb={label:g("optItemOverrideChrome",[zb("J",!0)]),type:"bool",value:!0,f:function(a){U.ga(a)}},Gb={label:"Slide details panel when click on task",type:"bool",value:!0,b:"SlideDetailsPanel",
tip:g("tipOptItemSlideDetailsPanel")},Ib={label:g("menuDLink"),type:"bool",value:!0,f:function(a){Hb.ec(a)},fa:function(a){this.f(a)}},Jb={label:g("menuDLinkOneClick"),type:"bool",value:!0,f:function(a){Hb.fc(a)},fa:function(a){this.f(a)}},Kb={label:"Clicking on a notification",type:"select",options:[g("menuOpenManager"),g("optOptionClearNotify"),g("optOptionClearAllNotify")],value:Za,b:"ClickNotify"},Lb={label:"Double-click on task",type:"select",options:[[g("optOptionDoNothing"),Wa],[g("optOptionOpenFile"),
Xa],[g("optOptionOpenFolder"),Ya]],value:Ya,b:"DblClickAction"},Mb={label:g("phraseEnable"),type:"bool",value:!0,tip:g("tipOptSectionOneClick"),tipURL:"http://faq.chronodownloader.net/index.php?sid=168941&lang=en&action=artikel&cat=7&id=3"},Nb={label:g("chromesysFontSize"),type:"int",value:14,min:12,max:16,f:function(a){t({cmd:"u_font_size",data:a})}},Ob=g("uilang"),T={Xa:Ab,items:{_uilanguage:Bb,fnconflict:Cb,def_threads:Db,def_addtop:Eb,def_addpause:{label:"Add paused",type:"bool",value:!1,b:"DefAddPaused"},
down_clipboard:{label:"Download URL from Clipboard",type:"bool",value:!0,b:"DownloadClipboard"},start_interrupted:{label:"Start Button also starts interrupted tasks",type:"bool",value:!1,b:"StartInterrupted"},override_cr:Fb,hide_cr_bar:{label:"Hide Chrome's Downloads Shelf(Bar)",type:"bool",value:!0,f:function(a){chrome.downloads.setShelfEnabled&&chrome.downloads.setShelfEnabled(!a)},b:"HideShelf"},slide_details_panel:Gb,recycle_cancel:{label:"Cancel the task when it's recycled",type:"bool",value:!1,
b:"RecycleCancel"},clear_search:{label:"Clear search box when filter changes",type:"bool",value:!1,b:"ClearSearch"},menu_d_dialog:Ib,menu_d_oneclick:Jb,notify_error:{label:"When error occurs",type:"bool",value:!0,f:function(a){0==a&&Pb("terr_")},b:"NotifyError"},notify_finish:{label:"When download completes",type:"bool",value:!0,f:function(a){0==a&&Pb("tfin_")},b:"NotifyFinish"},sound_finish:{label:"Play sound when download completes",type:"bool",value:!0,b:"SoundFinish"},sound_error:{label:"Play sound when error occurs",
type:"bool",value:!0,b:"SoundError"},notify_oneclick:{label:"When adding One-Click download",type:"bool",value:!1,f:function(a){0==a&&Pb("task_")},b:"NotifyOneClick"},notify_progress:{label:"Show download progress",type:"bool",value:!1,f:function(a){0==a&&Pb("task_")},b:"NotifyProgress"},notify_large_preview:{label:"Show large preview for images",type:"bool",value:"OPERA"==rb?!1:!0,b:"NotifyLargePreview"},click_notify:Kb,msg_singlet:{label:"Notify when task is not resumable",type:"bool",value:!0},
dbclick_action:Lb,doneclick_rule:Mb,badge_downnum:{label:"Show Downloading Number",type:"bool",value:!0,b:"BadgeDownloadNum",f:function(){V.u(-1)}},font_size:Nb,poplist_max_items:{label:"Max Items",type:"int",value:15,min:1,max:50,b:"PopMaxItems"},poplist_showd_first:{label:"Show downloading tasks first",type:"bool",value:!0,b:"PopShowDLFirst"},poplist_clear_close:{label:"Close after clear",type:"bool",value:!1,b:"PopClearClose"},dy_max_con_tasks:{label:"Concurrent downloads",type:"int",value:10,
min:1,max:20,rc:gb,b:"ConcurrentDownloads",f:function(){W.M()}},dy_max_per_server:{label:"Downloads per server",type:"int",value:5,min:1,max:5,b:"DownloadsPerServer",f:function(){W.M()}},always_use_last_location:{label:Ob.startsWith("en")||Ob.startsWith("zh")?g("labelUseLastLocation"):g("labelFolderColon")+" "+g("labelUseLastLocation"),type:"bool",value:!0},folder_inaccessible:{label:g("labelUnableSaveToFolder"),type:"select",options:[g("labelDownloadToDefaultFolder"),g("labelChooseDownloadLocation")],
value:db},def_folder:{label:"Default folder",type:"string",value:"",native_only:!0,tip:g("tipOptNoRuleMatch"),b:"DefFolder"},def_naming:{label:"Default Naming Mask",type:"string",value:"*name*.*ext*",sa:"*name*.*ext*",tip:g("tipOptNoRuleMatch"),b:"DefNaming"},match_mode:{label:"Match Mode",type:"select",options:[g("optOptionFirstMatch"),g("optOptionReplace")],value:Ua,tip:g("tipOptItemRuleMatchMode"),b:"RuleMatchMode"},tb_fit_cols:{type:"bool",value:!1},tb_sync_resize:{type:"bool",value:!1},tb_def_cols:{type:"string",
value:'["state","name","progress","size","speed","active_threads","time_remained","url","time_add"]'},tb_sort_cols:{type:"string",value:'[{"field":"time_add","sortAsc":false}]'},tb_free_order:{type:"string",value:"{}"},tip_rateshare:{type:"int",value:1,message:g("msgRateShare",[g("extName"),g("chromesysWebStore")])},tip_rateshare_wait:{type:"int",value:1},tip_translate:{type:"int",value:0},tip_notifications:{type:"int",value:0,message:g("tipmsgNotifications",[g("titleOptions")+" > "+g("titleOptionsInterface")+
" > "+g("optSectionNotifications")]),set_section:"interface.int-notifications",freq:6},tip_dblclick:{type:"int",value:0,message:g("tipmsgDoubleClick",[g("titleOptions")+" > "+g("titleOptionsInterface")+" > "+g("optSectionBehaviors")]),set_section:"interface.int-behaviors",freq:3},tip_slide:{type:"int",value:0,message:g("tipmsgSlideDetailsPanel",[g("titleOptions")+" > "+g("titleOptionsInterface")+" > "+g("optSectionBehaviors")]),set_section:"interface.int-behaviors",freq:5},tip_taskfilter:{type:"int",
value:0,message:g("tipmsgTaskFilter",[g("titleOptions")+" > "+g("titleOptionsRules")]),set_section:"rules",freq:4},tip_openmanager:{type:"int",value:0,message:g("tipmsgOpenShortcut",[g("extName"),zb("J",!0)]),freq:4},tip_grid:{type:"int",value:0,message:g("tipmsgGridSelection",[zb("A")]),freq:8},tip_copyselurls:{type:"int",value:0,message:g("tipmsgCopySelectedURLs",[zb("C")]),freq:1},tip_colfit:{type:"int",value:0,message:g("tipmsgFitColumnWidth"),freq:1},pop_preview:{type:"bool",value:!0},pop_showsize:{type:"bool",
value:!0},pop_content:{type:"int",value:0},pop_sniffer_hint:{type:"int",value:0},pop_clear_file:{type:"bool",value:!1},poplist_remove_confirm:{type:"select",value:fb,b:"PopDeleteAction",label:"Click 'Delete' button",options:[g("optOptionRemList"),g("optOptionRemFile"),g("optOptionRemAsk")]},preview_autoplay:{type:"bool",value:!1,b:"PreviewAutoplay"},bg_image_enable:{type:"bool",value:!1},bg_image_everset:{type:"bool",value:!1},bg_image_url:{type:"string",value:"../icons/bg/1.jpg"},bg_image_opacity:{type:"float",
value:.35,min:0,max:1},bg_image_blur:{type:"int",value:0,min:0,max:10},ui_grid_list:{type:"bool",value:!0},_glst:{type:"int",value:0},autoclear_type:{type:"string",value:"both"},autoclear_timer:{type:"int",value:-1},autoclear_lasttime:{type:"int",value:-1},search_mode:{type:"string",value:"normal"},search_case_sensitive:{type:"bool",value:!1},downloads_home:{type:"string",value:""}}};T.items.path_fav={type:"list",value:[]};
T.load=function(){for(var a in T.items){var b=T.items[a];b.b&&(b.label=g("optItem"+b.b));var l=localStorage["#"+a];if(void 0!=l)switch(b.type){case "bool":"true"==l?b.value=!0:"false"==l&&(b.value=!1);break;case "select":case "int":l=parseInt(l);isNaN(l)||l<b.min||l>b.max?console.log(`load from storage, invalid value for "${a}"`):b.value=l;break;case "float":l=parseFloat(l);isNaN(l)||l<b.min||l>b.max?console.log(`load from storage, invalid value for "${a}"`):b.value=l;break;case "list":try{const e=
JSON.parse(l);if(!Array.isArray(e))throw"bad value";b.value=e}catch(e){console.log(`load from storage, invalid value for "${a}"`)}break;default:b.value=l}b.fa&&b.fa(b.value)}Y.load();a=0;for(b=hb.length;a<b;++a);};T.commit=function(){Y.commit()};T.J=function(){return{addtop:T.get("def_addtop")}};T.get=function(a){return(a=T.items[a])?""===a.value?void 0==a.sa?"":a.sa:a.value:null};T.ca=function(a){return T.items[a]};T.jb=function(a){return T.Xa[a]};
T.set=function(a,b){var l=T.items[a];return l&&(void 0==l.min||b>=l.min)&&(void 0==l.max||b<=l.max)?(l.value=b,localStorage["#"+a]=b,l.f&&l.f(b),!0):!1};T.Ca=function(a){var b=T.items[a];if(b){var l=b.value?++b.value:1;b.value=l;localStorage["#"+a]=l;b.f&&b.f(l)}};T.Ja=function(a,b){let l=T.items[a];if(l){var e=l.value;if(e){for(let q=0;q<e.length;q++)if(e[q]==b){if(0==q)return;e.splice(q,1);break}e.unshift(b)}else e=[b];l.value=e;localStorage["#"+a]=JSON.stringify(e)}};
T.Ka=function(a,b){var l=T.items[a];if(l&&(l=l.value)){var e=!1;for(let q=0;q<l.length;q++)if(l[q]==b){e=!0;l.splice(q,1);break}e&&(localStorage["#"+a]=JSON.stringify(l))}};T.set=T.set;T.get=T.get;T.getRaw=T.ca;T.getCat=T.jb;T.inc=T.Ca;T.prependUnique=T.Ja;T.removeFromList=T.Ka;T.get_taskdef=T.J;T.commit=T.commit;T.canFileAccess=function(){return V.canFileAccess()};window.dy_settings=T;function Qb(a,b){function l(){if(v){var p=n.length;localStorage[u]=p;for(var h=0;h<p;++h)localStorage[y+h]=JSON.stringify(n[h]);for(h=p;15>h;++h)localStorage.removeItem(y+h);v=!1}}function e(p,h){return Math.sign(h.I-p.I)+3*Math.sign(h.time-p.time)}function q(p,h){if(p){var B=0,H=n.length,r=!1;h?h=h.getTime():(h=Date.now(),r=!0);for(var C=1;B<H;++B)if(n[B].value==p){if(4E3>h-n[B].time)return;C=n[B].I+1;n[B].I=r?1E6:C;n[B].time=h;break}B>=H&&(15<=H&&n.splice(14,1),n.push({value:p,I:r?1E6:C,time:h}));
n.sort(e);r&&(n[0].I=C);v=!0;l()}}var n=[],v=!1,y=a,u=b;return{load:function(p){var h=parseInt(localStorage[u]);isNaN(h)&&(h=0);for(var B,H=0;H<h;++H)(B=localStorage[y+H])&&n.push(JSON.parse(B));v=n.length!=h;l();if(0==h)for(H=0;H<p.length;++H)q(p[H])},commit:l,la:q,Ba:function(){for(var p=Math.min(6,n.length),h=[],B=0;B<p;++B)h.push(n[B].value);return h},ub:function(){return 0<n.length?n[0].value:null}}}var Rb=new Qb("path_rt_","path_rt_cnt"),Sb=new Qb("naming_rt_","naming_rt_cnt");var U=function(){function a(p,h){return p==h||p==h+"/"}function b(p){chrome.tabs.get(p.tabId,function(h){a("chrome://downloads/",h.url)&&q({c:!0,o:h.id})})}function l(p,h){a("chrome://downloads/",h.url)&&q({c:!0,o:p})}function e(p){a("chrome://downloads/",p.url)&&q({c:!0,o:p.id})}function q(p,h){function B(){h&&h();y=!1;if(0<u.length){var r=u.shift();q(r.Hb,r.Wa)}}function H(r){chrome.windows.getCurrent(function(C){chrome.runtime.lastError&&!C?(console.log(chrome.runtime.lastError),console.log("checking in one second"),
setTimeout(function(){H(r)},1100)):r&&r()})}y?(u.push({Hb:p,Wa:h}),console.log("still opening")):(y=!0,p||(p={c:!0}),void 0==p.c&&(p.c=!0),-1!=V.j?(p.o&&p.o!=V.j&&(console.log("opt.tabId != tab.id"),chrome.tabs.remove(p.o)),p.c&&(chrome.tabs.get(V.j,function(r){chrome.windows.update(r.windowId,{focused:!0})}),chrome.tabs.update(V.j,{active:!0})),B()):(V.Tb(B),p.o?(p.c&&chrome.tabs.get(p.o,function(r){chrome.windows.update(r.windowId,{focused:!0})}),chrome.tabs.update(p.o,{active:p.c,url:n})):H(function(){chrome.tabs.create({active:p.c,
url:n})})))}var n=chrome.extension.getURL("/ui/index.htm"),v=chrome.extension.getURL("/ui/options.htm"),y=!1,u=[];return{zb:n,vc:v,ya:function(p){chrome.windows.getLastFocused({populate:!1},function(h){chrome.tabs.query({active:!0,windowId:h.id},function(B){p(B&&B.length?B[0]:null)})})},ga:function(p){p?(chrome.tabs.onUpdated.hasListener(l)||chrome.tabs.onUpdated.addListener(l),chrome.tabs.onCreated.hasListener(e)||chrome.tabs.onCreated.addListener(e),chrome.tabs.onActivated.hasListener(b)||chrome.tabs.onActivated.addListener(b)):
(chrome.tabs.onUpdated.removeListener(l),chrome.tabs.onCreated.removeListener(e),chrome.tabs.onActivated.removeListener(b))},h:q,T:function(p){p||(p={});(function(h,B){chrome.tabs.query({url:h},function(H){H.length?B(H):chrome.tabs.query({url:h+"?*"},function(r){r.length?B(r):chrome.tabs.query({url:h+"#*"},function(C){C.length?B(C):chrome.tabs.query({url:h+".*"},function(K){B(K)})})})})})(v,function(h){var B=v+(p.W?"#"+p.W:"");if(h&&h.length){h=h[0];var H=p.C||h.windowId;if(p&&p.C&&p.L){var r=h.index,
C=p.L;h.windowId==p.C&&r<C&&--C;chrome.tabs.move(h.id,{windowId:p.C,index:C})}chrome.windows.update(H,{focused:!0});B!=h.url?chrome.tabs.update(h.id,{url:B,active:!0}):chrome.tabs.update(h.id,{active:!0})}else p&&p.C&&p.L?chrome.tabs.create({url:B,windowId:p.C,index:p.L}):chrome.tabs.create({url:B})})}}}();var Tb=function(){function a(v){console.log("StoreMan::onerror: "+v)}function b(v,y){if(e){var u=e.transaction("tasks","readwrite").objectStore("tasks");v.Eb(function(p){var h=V.ja(p);h&&(h=u.put({id:h.id,cr_id:h.cr_id,url:h.url,referer:h.referer,page_title:h.page_title,text:h.text,title:h.title,size:h.size,iconURL16:h.iconURL16,iconURL32:h.iconURL32,folder:h.folder,naming:h.naming,naming_auto:h.naming_auto,folder_auto:h.folder_auto,name_conflict:h.name_conflict,state:h.state,time_add:h.time_add,
time_finish:h.time_finish,time_elapsed:h.time_elapsed,max_threads_config:h.max_threads_config,checksum:h.checksum,desc:h.desc,batch_num:h.batch_num,hash:h.hash,exists:h.exists,_start_time:h._start_time,temp_file:h.temp_file,recycled:h.recycled,blocksize:h.blocksize,blocks:h.lc,finished_blocks:h.finished_blocks,finished_bytes:h.finished_bytes,etag:h.etag,last_modified:h.last_modified,mime_type:h.mime_type,file_ext:h.file_ext,full_path:h.full_path,eurl:h.eurl,single_thread:h.single_thread,error_str:h.error_str}),
h.onsuccess=function(){v.clear(p)},h.onerror=function(B){console.log("IDB updateTask "+p+" fail");console.log(B)})});y&&y()}}function l(v){b(V.g,function(){v&&v()})}var e=null,q=window.indexedDB||window.webkitIndexedDB,n=null;return{open:function(v){var y=q.open("downloady",1);y.onerror=a;y.onsuccess=function(){var u=y.result;!y.hasOwnProperty("onupgradeneeded")&&u.xc?(console.log("Your Chrome's version is too low, indexedDB doesn't work well"),alert("Your Chrome's version is too low, indexedDB doesn't work well")):
(e=u,u.onerror=a,console.log("dbopened"),v&&setTimeout(v,0))};y.onupgradeneeded=function(u){console.log("dbupgradeneeded");u=u.target.result;console.log("dbupdated");u.createObjectStore("tasks",{keyPath:"id"})}},close:function(){e&&(e.close(),e=null)},clear:function(v){if(e){var y=e.transaction(["tasks"],"readwrite");y.onerror=a;y.objectStore("tasks").clear().onsuccess=function(){v&&v()}}else v&&v()},Ob:function(v){if(e){var y=e.transaction("tasks","readwrite").objectStore("tasks").delete(v);y.onsuccess=
function(){};y.onerror=function(u){console.log("IDB removeTaskById "+v+" fail");console.log(u)}}},Pb:function(v){if(e)for(var y=e.transaction("tasks","readwrite").objectStore("tasks"),u=0;u<v.length;++u)y.delete(v[u].id)},Nb:function(v){if(e)for(var y=e.transaction("tasks","readwrite").objectStore("tasks"),u=0;u<v.length;++u)y.delete(v[u])},fb:function(v){if(e){var y=[],u=e.transaction("tasks").objectStore("tasks").openCursor();u.onsuccess=function(p){(p=p.target.result)?(y.push(new R(p.value)),p.continue()):
(console.log("done"),v(y))};u.onerror=function(p){v(y);console.log(p)}}else console.log("getAllTasks: db not ready"),v([])},commit:l,$b:function(){n=setInterval(l,3E3)},bc:function(){clearInterval(n);n=null}}}();var Hb=function(){function a(r,C,K,E){void 0==H[r]&&(H[r]=chrome.contextMenus.create({title:C,contexts:K,onclick:E,documentUrlPatterns:["http://*/*","https://*/*","ftp://*/*"]}))}function b(r){var C=H[r];void 0!=C&&(chrome.contextMenus.remove(C),delete H[r])}function l(r,C,K){var E={cmd:"d_one",task:{}};E.task.referer=C;E.task.url=r;if(r=Ub.va(r))E.task.text=r.text,E.task.title=r.title,E.task.desc=r.download||r.text||r.title;chrome.tabs.sendMessage(K.id,E,function(f){f||(console.log("menu download no response"),
U.h({c:!0},function(){t(E)}))})}function e(r,C,K){var E={};E.url=r;E.referer=C;var f=T.J();C=T.get("def_addpause");f=f.addtop;chrome.tabs.sendMessage(K.id,{cmd:"d_anim",addpause:C});K="";if(r=Ub.va(r))E.text=r.text,E.title=r.title,E.desc=r.download||E.text||E.title,K=r.page_title;Vb.ba()({cmd:"new_task",add_paused:C,addtop:f,tasks:[E],notify:!0,page_title:K,source:"ctxmenu_1click"},{},function(){})}function q(){U.h()}function n(r,C){U.T({C:C.windowId,L:C.index+1,W:"help"})}function v(){chrome.tabs.create({active:!0,
url:"http://faq.chronodownloader.net"})}function y(){chrome.tabs.create({active:!0,url:"http://bugs.chronodownloader.net"})}function u(r,C){r.linkUrl&&l(r.linkUrl,r.pageUrl||r.frameUrl,C)}function p(r,C){r.srcUrl&&l(r.srcUrl,r.pageUrl||r.frameUrl,C)}function h(r,C){r.linkUrl&&e(r.linkUrl,r.pageUrl||r.frameUrl,C)}function B(r,C){r.srcUrl&&e(r.srcUrl,r.pageUrl||r.frameUrl,C)}var H={};return{ec:function(r){r?(a("d_link",g("menuDLink"),["link"],u),a("d_image",g("menuDImage"),["image"],p),a("d_video",
g("menuDVideo"),["video"],p),a("d_audio",g("menuDAudio"),["audio"],p)):(b("d_link"),b("d_image"),b("d_video"),b("d_audio"))},fc:function(r){r?(a("d_link_oneclick",g("menuDLinkOneClick"),["link"],h),a("d_image_oneclick",g("menuDImageOneClick"),["image"],B),a("d_video_oneclick",g("menuDVideoOneClick"),["video"],B),a("d_audio_oneclick",g("menuDAudioOneClick"),["audio"],B)):(b("d_link_oneclick"),b("d_image_oneclick"),b("d_video_oneclick"),b("d_audio_oneclick"))},Qa:function(){a("ba_openmanager",g("menuOpenManager"),
["browser_action"],q);a("ba_changedir",g("tipBtnChangeDefaultLocation"),["browser_action"],ma.bind(void 0,"ba"));a("ba_help",g("menuGetHelp"),["browser_action"],n);a("ba_faq",g("btnFAQ"),["browser_action"],v);a("ba_report",g("menuReportIssue"),["browser_action"],y);"zh-CN"!=chrome.i18n.getUILanguage()&&a("ba_translate","Help us with translation",["browser_action"],function(){chrome.tabs.create({active:!0,url:"http://translate.chronodownloader.net"})})}}}();var Ub=function(){function a(u,p,h){u=V.$(u,p);if(!u)return null;T.J();h?(u.mime_type=h.mime,u.size=h.totalBytes,u.exists=h.exists):u.exists=!0;(h=v[u.url])?(u.text=h.text,u.title=h.title,u.desc=h.download||u.text||u.title,u.page_title=h.page_title):console.log("url desc not found");return u}function b(u){const p=u.url;if(p==Wb.Na)console.debug("ignore special URL");else if(n[p]){var h=n[p];h.state=J;q[u.id]=h;delete n[p]}else if("in_progress"==u.state&&(u.byExtensionId&&console.log(u.byExtensionId),
!Z.vb(u))){var B=u.referrer;if(Y.Db(p))chrome.downloads.cancel(u.id,function(){chrome.downloads.erase({id:u.id})}),U.ya(function(r){var C={cmd:"d_one",task:{}};C.task.url=p;C.task.referer=B;var K=v[p];K?(C.task.text=K.text,C.task.title=K.title,C.task.desc=K.download||K.text||K.title):console.log("desc not found");chrome.tabs.sendMessage(r.id,C,function(E){E||U.h({c:!0},function(){t(C)})})});else{h=T.get("def_addpause");var H=a(p,B,u);H?h||!Z.xb()?(chrome.downloads.cancel(u.id,function(){chrome.downloads.erase({id:u.id})}),
H.reset(h?Sa:Ra),h||(W.enqueue(H),V.u(!0)),V.qa(H,h)):(H.state=J,q[u.id]=H):(chrome.downloads.cancel(u.id,function(){chrome.downloads.erase({id:u.id})}),U.h({c:!0},function(){t({cmd:"u_alert",data:kb.noID})}))}}}function l(u){var p=q[u.id];if(p){for(var h in u){var B=u[h].current;switch(h){case "url":p.eurl=B;break;case "mime":p.mime_type=B;break;case "exists":p.exists=B;break;case "endTime":p.time_finish=new Date(B);break;case "state":"interrupted"==B?p.state=P:"complete"==B?p.state=L:"in_progress"==
B&&(B=u.paused,p.state=B&&B.current?Sa:J);break;case "paused":u.state||(p.state=B?Sa:J);break;case "error":if((p.error_str=B)&&0==B.toUpperCase().indexOf("USER_")){delete q[u.id];console.log("cancel in Save As: "+u.id);return}break;case "totalBytes":case "fileSize":p.size=B;break;case "danger":"safe"!=B&&"accepted"!=B&&(p.X=!0)}}(h=u.filename)&&!h.previous&&(delete q[u.id],p.full_path=h.current,Z.oa(p,u.id,h.current,!1))}}function e(u){q[u]&&(console.log("cancel in Save As: "+u),delete q[u])}var q=
{};const n={};var v={},y=[];return{pa:function(u,p){p=a(u,p);if(!p)return!1;p.Oa=!0;n[u]=p;chrome.downloads.download({url:u,method:"GET",saveAs:!0},function(){});return!0},rb:function(u){return q[u]},va:function(u){return v[u]},Ub:function(u,p,h,B,H){if(u){if(void 0!=v[u])for(var r=0;r<y.length;++r)if(y[r]==u){y.splice(r,1);break}18<=y.length&&(delete v[y[0]],y.shift());y.push(u);v[u]={download:p,text:h,title:B,page_title:H}}},start:function(){chrome.downloads.onCreated.hasListener(b)||chrome.downloads.onCreated.addListener(b);
chrome.downloads.onChanged.hasListener(l)||chrome.downloads.onChanged.addListener(l);chrome.downloads.onErased.hasListener(e)||chrome.downloads.onErased.addListener(e)},stop:function(){chrome.downloads.onCreated.removeListener(b);chrome.downloads.onChanged.removeListener(l);chrome.downloads.onErased.removeListener(e)}}}();var Y=function(){function a(E){return E.replace(/\[([^\]]+)\]/gi,function(f,A){f=A?A.trim().toLowerCase():"";if(1==K[f])throw"dy_rules.expand_exts: loop of link filter ["+f+"] detected";K[f]=!0;A=b(f);delete K[f];if(!A)throw"dy_rules.expand_exts: ref link filter ["+f+"] not found";return"("+A+")"})}function b(E){for(var f=0;f<h.length;++f)if(h[f].int_name==E)try{return a(h[f].exts)}catch(A){console.log(A);break}return null}function l(E,f){for(var A in E)E.hasOwnProperty(A)&&!f.hasOwnProperty(A)&&
(f[A]=E[A]);return f}function e(){y=!0;n()}function q(){v=!0;n()}function n(){v&&(localStorage.lfilters=JSON.stringify(h),v=!1);if(y){localStorage.rules=JSON.stringify(r);for(var E=y=!1,f={},A=0,D=r.length;A<D;++A){for(var N=-1,Q=0,da=C.length;Q<da;Q+=2)if(C[Q]==r[A].id){N=Q;f[r[A].id]=1;break}r[A].as_filter?-1==N&&(C.push(r[A].id),C.push(0),E=!0,f[r[A].id]=1):0<=N&&(C.splice(N,2),E=!0)}for(Q=C.length-2;0<=Q;Q-=2)f[C[Q]]||(C.splice(Q,2),E=!0);E&&(localStorage.disp_filters=JSON.stringify(C));t({cmd:"u_filters",
rebuild:E})}}var v=!0,y=!0,u=new ba(500),p={caption:g("extsNew"),int_name:"",exts:".*",filter_links:!1},h=[{caption:g("extsImage"),int_name:"ext_image",exts:"bmp|cur|dds|exr|gif|ico|jpg|jpeg|pcx|pbm|pfm|pgm|ppm|png|psd|svg|tga|tif|tiff|webp",filter_links:!0},{caption:g("extsVideo"),int_name:"ext_video",exts:"3gp|3g2|asf|avi|f4f|f4i|f4m|f4v|flv|h264|m4v|mkv|mov|mp4|mpg|ogg|ogv|qt|rm|rmvb|ts|vob|webm|wmv",filter_links:!0},{caption:g("extsAudio"),int_name:"ext_audio",exts:"aac|aif|ape|flac|oga|opus|m3u|m4a|mid|midi|mp3|ra|wav|wma|weba",
filter_links:!0},{caption:g("extsDocument"),int_name:"ext_doc",exts:"c|cfg|cpp|cs|css|csv|dat|doc|docx|h|hpp|ini|js|log|m|pdf|ppt|pptx|ps|py|rtf|sh|tex|torrent|txt|xls|xlsx",filter_links:!0},{caption:g("extsArchive"),int_name:"ext_arch",exts:"7z|bin|cbr|cue|deb|dmg|gz|iso|mdf|pkg|rar|rpm|sitx|tar.gz|vcd|zip",filter_links:!0},{caption:g("extsApp"),int_name:"ext_app",exts:"apk|app|bat|cgi|com|dll|exe|gadget|jar|msi|pif|sys",filter_links:!0},{caption:g("extsAll"),int_name:"ext_all",exts:"[ext_audio]|[ext_video]|[ext_image]|[ext_doc]|[ext_arch]|[ext_app]",
filter_links:!1}],B={id:-1,int_name:"",condition:"true",as_filter:!1,caption:g("ruleNew"),active:!1,folder:"",naming:"",post_action:""},H=1,r=[{id:H++,int_name:"r_recent",condition:"*time_add*>=[3_days_ago]",as_filter:!0,caption:g("ruleRecent"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:H++,int_name:"r_downloading",condition:"*state*!=[finished]&&*state*!=[interrupted]",as_filter:!0,caption:g("ruleDownloading"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:H++,
int_name:"r_done",condition:"*state*==[finished]",as_filter:!0,caption:g("ruleFinished"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:H++,int_name:"r_done_image",condition:"{r_done}&&*ext*.is([ext_image])",as_filter:!0,caption:g("ruleImage"),active:!1,folder:"./images",naming:"",post_action:"<file>",init_indent:1},{id:H++,int_name:"r_done_video",condition:"{r_done}&&*ext*.is([ext_video])",as_filter:!0,caption:g("ruleVideo"),active:!1,folder:"./videos",naming:"",post_action:"",init_indent:1},
{id:H++,int_name:"r_done_audio",condition:"{r_done}&&*ext*.is([ext_audio])",as_filter:!0,caption:g("ruleAudio"),active:!1,folder:"./music",naming:"",post_action:"",init_indent:1},{id:H++,int_name:"r_done_doc",condition:"{r_done}&&*ext*.is([ext_doc])",as_filter:!0,caption:g("ruleDocument"),active:!1,folder:"./docs",naming:"",post_action:"<file>",init_indent:1},{id:H++,int_name:"r_done_other",condition:"{r_done}&&!(*ext*.is([ext_audio])||*ext*.is([ext_video])||*ext*.is([ext_image])||*ext*.is([ext_doc]))",
as_filter:!0,caption:g("ruleOther"),active:!1,folder:"",naming:"",post_action:"",init_indent:1},{id:H++,int_name:"r_interrupted",condition:"*state*==[interrupted]",as_filter:!0,caption:g("ruleInterrupted"),active:!1,folder:"",naming:"",post_action:"",init_indent:0},{id:H++,active:!1,caption:g("ruleSmallFiles"),int_name:"r_smallf",condition:"*size*>0&&*size*<kb(1024)",folder:"./small_files",naming:"",as_filter:!1,post_action:"<folder>"}],C=[],K={};return{Db:function(){return 1!=T.get("doneclick_rule")},
Ab:"aac|aif|ape|flac|oga|opus|m3u|m4a|mid|midi|mp3|ra|wav|wma|weba",Da:"3gp|3g2|asf|avi|f4f|f4i|f4m|f4v|flv|h264|m4v|mkv|mov|mp4|mpg|ogg|ogv|qt|rm|rmvb|ts|vob|webm|wmv",Bb:"bmp|cur|dds|exr|gif|ico|jpg|jpeg|pcx|pbm|pfm|pgm|ppm|png|psd|svg|tga|tif|tiff|webp",pb:function(){return h},za:function(){return r},sb:function(){for(var E=[],f=0,A=C.length;f<A;f+=2)for(var D=0,N=r.length;D<N;++D)r[D].id==C[f]&&1==r[D].as_filter&&E.push({id:r[D].id,caption:r[D].caption,filter:r[D].condition,indent:C[f+1]});return E},
Wb:function(E){C=E;localStorage.disp_filters=JSON.stringify(C)},Sa:function(E){E=l(B,E);E.id=u.Ea(!0);r.push(E);e();ia("rules")},Ra:function(E){E=l(p,E);h.push(E);q();ia("ext_filters")},Mb:function(E){for(var f=0;f<r.length;++f)if(r[f].int_name==E)return r[f].condition;return null},Kb:function(E){K={};return b(E)},Lb:function(E){K={};var f=null;if(0<=E&&E<h.length)try{f=a(h[E].exts)}catch(A){console.log(A)}return f},Gb:e,Fb:q,load:function(){var E=localStorage.getItem("lfilters");E&&(h=JSON.parse(E));
(E=localStorage.getItem("rules"))&&(r=JSON.parse(E));if(E=localStorage.getItem("disp_filters"))C=JSON.parse(E);else for(C=[],E=0;E<r.length;++E){var f=r[E];void 0!=f.init_indent&&(C.push(f.id),C.push(f.init_indent))}for(E=0;E<r.length;++E)u.set(r[E].id);v=y=!1},commit:n,match:function(E){for(var f=T.get("match_mode"),A={},D=0;D<r.length;++D)if(r[D].active&&Xb.cc(E,r[D].condition))if(f==Ua){E=r[D];A.naming=E.naming;A.folder=E.folder;A.post_action=E.post_action;break}else if(f==Va){var N=ra(r[D].naming);
N&&(A.naming=N)}A.naming||(A.naming=T.get("def_naming"));return A},bb:function(){return{naming:T.get("def_naming"),folder:T.get("def_folder")}}}}();Y.internal_video=Y.Da;Y.getLinkFilters=Y.pb;Y.getRules=Y.za;Y.get_display_filters=Y.sb;Y.set_display_filters=Y.Wb;Y.ref_filteri=Y.Lb;Y.addRule=Y.Sa;Y.addFilter=Y.Ra;Y.on_rules_change=Y.Gb;Y.on_filters_change=Y.Fb;window.dy_rules=Y;var Xb=function(){function a(){var f=new Date;u=f.getTime();n=f.getDay();v=f.getMonth();y=f.getFullYear();f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setMilliseconds(0);p=f.getTime();h=p+864E5-1}function b(f){return f.replace(/\.match/g,".bmatch").replace(/\*([^\*]+)\*/gi,function(A,D){return"Fd('"+D.trim().toLowerCase()+"')"}).replace(/\{([^\}]+)\}/gi,function(A,D){A=D?D.trim().toLowerCase():"";if(1==C[A])throw"circular dependency of rules detected";D=Y.Mb(A);if(null==D||void 0==D)throw"referenced rule {"+
A+"} not found";C[A]=!0;D="("+b(D)+")";delete C[A];return D}).replace(/\[([^\]]+)\]/gi,function(A,D){A=D?D.trim().toLowerCase():"";a:if(D=B[A],void 0!=D)D="function"==typeof D?"new Date("+D()+")":D;else{var N;if(N=A.match(/(\d+)_([a-z]+_ago_?)/)){D=parseInt(N[1]);if(isNaN(D)||0>=D)throw"bad number in: "+A;if(N=B[N[2]]){D="new Date("+N(D)+")";break a}throw"not supported function: "+A;}D=null}if(void 0!=D&&null!=D)return D;D=Y.Kb(A);if(void 0==D||null==D)throw"constant/referenced ext filter ["+A+"] not found";
return'"'+D+'"'})}function l(f,A){if(!f||""==f||"true"==f)return"true";0!=A&&a();A=null;try{C={},A=b(f)}catch(D){return console.log("Invalid filter expression: "+D),null}return A}function e(f,A,D){if(!f)throw Error();if(A.recycled)return!1;K.ea=A;K.Ga=D;f=(new Function("with(this) { 'use strict';return ( "+f+" )}")).call(K);K.ea=void 0;K.Ga=void 0;return f}function q(f,A,D,N){try{return e(f,A,D)}catch(Q){return t({cmd:"u_badfilter",filter:N||""}),Q.message&&console.log("Invalid filter expression: "+
Q),!1}}String.prototype.bmatch=function(f){return null!=this.match(f)};String.prototype.is=function(f){return(new RegExp("^("+f+")$")).test(this)};String.prototype.has=function(f){return(new RegExp(f)).test(this)};String.prototype.beginwith=function(f){return(new RegExp("^("+f+")")).test(this)};String.prototype.endwith=function(f){return(new RegExp("("+f+")$")).test(this)};Date.prototype.is=function(f){var A=B[f],D=B[f+"_"];if(null!=A&&null!=D)return"function"==typeof A&&(A=A()),"function"==typeof D&&
(D=D()),this.getTime()>=A&&this.getTime()<=D;if(D=f.match(/(\d+)_([a-z]+)_ago/)){var N=parseInt(D[1]);if(isNaN(N)||0>=N)throw"bad number in: "+f;A=B[D[2]+"_ago"];D=B[D[2]+"_ago_"];if(A&&D)return A=A(N),D=D(N),this.getTime()>=A&&this.getTime()<=D}throw"fail to parse: "+f;};Date.prototype.btwn=function(f,A){"string"==typeof f&&(f=Date.parse(f));"string"==typeof A&&(A=Date.parse(A));return this.getTime()>f&&this.getTime()<A};Date.prototype._btwn=function(f,A){"string"==typeof f&&(f=Date.parse(f));"string"==
typeof A&&(A=Date.parse(A));return this.getTime()>=f&&this.getTime()<A};Date.prototype.btwn_=function(f,A){"string"==typeof f&&(f=Date.parse(f));"string"==typeof A&&(A=Date.parse(A));return this.getTime()>f&&this.getTime()<=A};Date.prototype._btwn_=function(f,A){"string"==typeof f&&(f=Date.parse(f));"string"==typeof A&&(A=Date.parse(A));return this.getTime()>=f&&this.getTime()<=A};Date.prototype.b4=function(f){"string"==typeof f&&(f=Date.parse(f));return this.getTime()<f};Date.prototype.b4_=function(f){"string"==
typeof f&&(f=Date.parse(f));return this.getTime()<=f};Date.prototype.aft=function(f){"string"==typeof f&&(f=Date.parse(f));return this.getTime()>f};Date.prototype.aft_=function(f){"string"==typeof f&&(f=Date.parse(f));return this.getTime()>=f};var n=0,v=0,y=0,u=0,p=0,h=0,B={mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,sun:0,download:J,inqueue:Ra,paused:Sa,finished:L,interrupted:P,now:function(){return u},today:function(){return p},today_:function(){return h},yesterday:function(){return p-864E5},yesterday_:function(){return p-
1},this_week:function(){return p-864E5*n},this_week_:function(){return B.this_week()+6048E5-1},last_week:function(){return B.this_week()-6048E5},last_week_:function(){return B.this_week()-1},this_month:function(){var f=new Date(p);f.setDate(1);return f.getTime()},this_month_:function(){var f=new Date(p);f.setMonth(v+1);f.setDate(1);return f.getTime()-1},last_month:function(){var f=new Date(p);f.setMonth(v-1);f.setDate(1);return f.getTime()},last_month_:function(){return B.this_month()-1},this_year:function(){var f=
new Date(p);f.setMonth(0);f.setDate(1);return f.getTime()},this_year_:function(){var f=new Date(p);f.setYear(y+1);f.setMonth(0);f.setDate(1);return f.getTime()-1},last_year:function(){var f=new Date(p);f.setYear(y-1);f.setMonth(0);f.setDate(1);return f.getTime()},last_year_:function(){return B.this_year()-1},days_ago:function(f){return p-864E5*f},days_ago_:function(f){return p-864E5*(f-1)-1},weeks_ago:function(f){return B.this_week()-6048E5*f},weeks_ago_:function(f){return B.this_week()-6048E5*(f-
1)-1},months_ago:function(f){var A=new Date(B.this_month());A.setMonth(v-f);return A.getTime()},months_ago_:function(f){return B.months_ago(f-1)-1},years_ago:function(f){var A=new Date(B.this_year());A.setFullYear(y-f);return A.getTime()},years_ago_:function(f){return B.years_ago(f-1)-1}};a();var H="true",r,C={},K={},E;for(E in this)K[E]=void 0;K.eval=void 0;K.uneval=void 0;K.Function=void 0;K.Genertor=void 0;K.GenertorFunction=void 0;K.Promise=void 0;K.Object=void 0;K.String=String;K.Date=Date;K.Fd=
function(f){if(1==this.Ga){var A=this.ea,D=ya(A),N;D.file&&""!=D.file&&(N=Aa(D.file));var Q=null;switch(f){case "host":Q=D.host;break;case "query":case "anchor":Q=D[f];break;case "subdirs":Q=D.directory;break;case "name":Q=N?N.R:"";break;case "ext":Q=N?N.v:"";break;case "url":Q=A}f=Q||""}else f=this.ea.tb(f);return f};K.yearof=function(f){return(new Date(f)).getFullYear()};K.monthof=function(f){return(new Date(f)).getMonth()};K.dateof=function(f){return(new Date(f)).getDate()};K.dayof=function(f){return(new Date(f)).getDay()};
K.hourof=function(f){return(new Date(f)).getHours()};K.minuteof=function(f){return(new Date(f)).getMinutes()};K.secondof=function(f){return(new Date(f)).getSeconds()};K.kb=function(f){return f<<10};K.mb=function(f){return f<<20};K.gb=function(f){return f<<30};K.sec=function(f){return 1E3*f};K.min=function(f){return 6E4*f};K.hr=function(f){return 36E5*f};K.hour=function(f){return 36E5*f};return{lb:function(){return H},$a:function(f){return q(H,f,void 0,r)},cc:function(f,A,D){D=l(A,D);return q(D,f,
!1,A)},Za:function(f,A){H=l(f,A)||"";r=f},compile:l,dc:e}}();Xb.compileCache=Xb.Za;Xb.compiledTest=Xb.$a;Xb.getCompiledFilter=Xb.lb;window.dy_taskfilter=Xb;function Yb(a,b,l){"CHROME"!=rb&&delete b.buttons;chrome.notifications.create(a,b,l)}
chrome.notifications.onClicked.addListener(function(a){if(-1!=a.indexOf("task_")||-1!=a.indexOf("terr_")||-1!=a.indexOf("tfin_")||-1!=a.indexOf("tmsg_")){var b=T.get("click_notify");b==Za?(U.h({c:!0},function(){t({cmd:"u_scroll",id:a.substring(5)})}),chrome.notifications.clear(a,function(){})):b==$a?chrome.notifications.clear(a,function(){}):Zb()}else-1!=a.indexOf("tip_")?(T.set(a,100),chrome.notifications.clear(a,function(){})):-1!=a.indexOf("int_")&&(chrome.notifications.clear(a,function(){}),U.h({c:!0}))});
chrome.notifications.onButtonClicked.addListener(function(a,b){if("reload_update"==a){if(0==b){chrome.runtime.reload();return}}else if(-1!=a.indexOf("task_")||-1!=a.indexOf("terr_"))U.h({c:!0},function(){t({cmd:"u_scroll",id:a.substring(5)})});else if(-1!=a.indexOf("tfin_")){var l=V.ja(a.substring(5));0==b?$b.exec(l):1==b&&$b.eb(l)}else-1!=a.indexOf("tip_")&&(T.set(a,100),1==b&&(b=T.ca(a))&&(b.set_section?U.T({W:b.set_section}):b.set_page&&chrome.tabs.create({url:b.set_page})));chrome.notifications.clear(a,
function(){})});function ac(a){if(!localStorage["noup_"+a]){var b={type:"basic",title:g("msgTitleUpdateAvail",[a]),priority:2,message:g("msgTextUpdateAvail"),iconUrl:"../icons/noty/update.png",buttons:[{title:g("btnUpdateReload")},{title:g("btnLater")}]};Yb("reload_update",b,function(){});localStorage["noup_"+a]=1}}
function bc(){var a=T.ca("tip_notifications");if(a&&a.message&&!(a.value>=a.freq)&&!a.Yb&&(T.Ca("tip_notifications"),!a.freq||a.value==a.freq)){T.set("tip_notifications",0);var b={type:"basic",title:g("titleTips"),priority:1,message:a.message,iconUrl:"../icons/logo/48.png",buttons:[{title:g("btnGotIt"),iconUrl:"../icons/tick.png"}]};(a.set_section||a.set_page)&&b.buttons.push({title:g("btnTakeMeThere"),iconUrl:"../icons/noty/gear.png"});Yb("tip_notifications",b,function(){});a.Yb=!0}}
function cc(a,b){a&&!a.G&&a.state!=L&&a.state!=P&&(b={type:"basic",title:a.m?a.m():a.s(),message:b?g("msgTaskAddPaused"):g("msgTaskStart"),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",
buttons:[{title:g("btnOpenManager"),iconUrl:"../icons/noty/table.png"}]},Yb("task_"+a.id,b,function(){}),setTimeout(function(){bc()},0))}function dc(a){if(a&&a.length&&!(3>=a.length)){for(let e=0;e<a.length-1;e++)a[e].G=!0;var b=a[0],l=a[a.length-1];l.m=()=>[b.s(),"...",l.s()].join(", ")}}
function ec(a){if(a&&!a.G&&a.state==J){var b=function(n){if(0>=n.size)return 0<n.finished_bytes?Ka(n.finished_bytes):g("phraseUnknownSize");var v=Ka(n.size);return n.state==L||n.state==P?v:g("statusDownloadedSize",[Ka(n.finished_bytes),v])}(a),l=La(a.speed),e=Ja(a.time_remained),q=b+"\n"+l+" - "+g("statusTimeLeft",[e]);chrome.notifications.update("task_"+a.id,{progress:Math.round(a.progress),message:q},function(n){chrome.runtime.lastError&&console.log(chrome.runtime.lastError);if(!n){-1<navigator.platform.indexOf("Mac")?
chrome.notifications.clear("task_"+a.id,v):v();function v(){a.state==J&&Yb("task_"+a.id,{type:"progress",priority:2,title:a.m?a.m():a.s(),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",
buttons:[{title:g("btnOpenManager"),iconUrl:"../icons/noty/table.png"}],progress:Math.round(a.progress),message:q},function(){})}}})}}
function fc(a){if(a&&!a.G){var b=!1;T.get("sound_finish")&&((new Audio("../snds/finish.ogg")).play(),b=!0);if(T.get("notify_finish")){var l=/^(jpe?g|gif|png|bmp|ico|webp|svg)$/i;b={type:"basic",title:a.m?a.m():a.s(),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",message:g("msgTaskFinish"),
silent:b,buttons:[{title:g("optOptionOpenFile"),iconUrl:"../icons/noty/file.png"},{title:g("optOptionOpenFolder"),iconUrl:"../icons/noty/folder_open.png"}]};var e="";if(V.P&&a.full_path){var q=Aa(a.Aa());q.v&&l.test(q.v)&&(e="file:///"+a.full_path)}e&&(T.get("notify_large_preview")?(b.type="image",b.imageUrl=e):(b.iconUrl=e,a.na=!0));Yb("tfin_"+a.id,b,function(){gc(a)});setTimeout(function(){bc()},0)}else gc(a)}}
function hc(a){if(a&&!a.G){var b=!1;T.get("sound_error")&&((new Audio("../snds/error.ogg")).play(),b=!0);T.get("notify_error")?(b={type:"basic",title:a.m?a.m():a.s(),iconUrl:a.iconURL32||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACEElEQVRYhe2XsZLaMBCGfyfmmAMSGJ7k6stkGOBxrsprpKG5VEdDYV6DV7hH4A2SSUOj1aawZdaWtLIIXaKZHayV0ffvaiUB8K+3IuSsqooBgJmFAQwGAj7Xr4cZ5aj89ftyWX97eXm/SVVVVUxEnhlppm+GrbV8PB75fD7z237/c7fbPaVYH0JOZgYAWGtB1oKoNksEkmYJhq5mrQUALJdLbNabxWQ6PaVEqAI8f/sUXLm2ERHm889YrVaL8ePk9F0RoQoIywDgxiMvGGNARPg0m+Hrl+fFbDw+xaYqlfnRVRGTw+hn5HA4dCEPD4s8AQ7G0udaUfeaD8k3hrDZbkUAjPJjiepYxfhhATIF3Im88NNfOCV1m89FsMwoyzK6VIBSA6zBA0L9FRJBKAoSu6BowALWLjd70fcxrq8JiBehhDZg5y/AYFl4oeg7ycnNgCsyB5ZaWMKvoFj09VeyM8DXuQW4FiTSHoSzrmawALfHuIEWIuoE3OPnZqCeoSnAwsfE0h6Co7ktswR0MtCDBsGRyN27WhEOPgnDYB2eujPiAtqDKNV0+F+cAyl0fPv14a6fKSAA7D1qV/UddgH7J6EGTYBuLsJ0DbRk9d2bivAe4CHzDayBzmi88u8noHcUIw8YmDBTQFMFQ1ciyVfG1J9ko1F4OFvALTXw+vqjORG7f7uuPndt+77WD9H/3yLtD31m5EbWJHnAAAAAAElFTkSuQmCC",
message:g("msgTaskInterrupt"),silent:b,buttons:[{title:g("btnOpenManager"),iconUrl:"../icons/noty/table.png"}]},a.error_str&&(b.contextMessage=lb(a.error_str)),Yb("terr_"+a.id,b,function(){gc(a)}),setTimeout(function(){bc()},0)):gc(a)}}function ic(a,b){chrome.notifications.update("task_"+a.id,{title:b},function(){});chrome.notifications.update("tfin_"+a.id,{title:b},function(){});chrome.notifications.update("terr_"+a.id,{title:b},function(){})}
function jc(a,b){chrome.notifications.update("task_"+a.id,{iconUrl:b},function(){});a.na||chrome.notifications.update("tfin_"+a.id,{iconUrl:b},function(){});chrome.notifications.update("terr_"+a.id,{iconUrl:b},function(){})}function kc(a){(T.get("notify_oneclick")||T.get("notify_progress"))&&chrome.notifications.clear("task_"+a,function(){});T.get("notify_finish")&&chrome.notifications.clear("tfin_"+a,function(){});T.get("notify_error")&&chrome.notifications.clear("terr_"+a,function(){})}
function lc(a){kc(a.id)}function gc(a){chrome.notifications.clear("task_"+a.id,function(){})}function Pb(a){chrome.notifications.getAll(function(b){for(var l in b)-1!=l.indexOf(a)&&chrome.notifications.clear(l,function(){})})}function Zb(){chrome.notifications.getAll(function(a){for(var b in a)chrome.notifications.clear(b,function(){})})};var nc=function(){function a(e){if(-1!=e.tabId){var q=-1,n="",v="";if(e.responseHeaders)for(var y=0;y<e.responseHeaders.length;++y){var u=e.responseHeaders[y];if("content-type"==u.name.toLowerCase())n=(u.value||"").trim();else if("content-length"==u.name.toLowerCase()){if(q=parseInt(u.value),isNaN(q)||!isFinite(q))q=-1}else"content-disposition"==u.name.toLowerCase()&&(v=(v=u.value)?(v=v.match(/filename="([^"]+)"/i))?v[1]||"":"":"")}y=Aa(v).v||Aa(ya(e.url).file).v;if(n&&l.test(n)||y&&b.test(y))y||
(n=n.match(/(?:[^\/]+)\/(?:x-)?(?:vnd\.)?(.+)/i))&&n[1]&&(y=xa[n[1]]||n[1]),q={cmd:"stream_url",url:e.url,size:q,need_send:e.tabId==V.Ia},v&&(q.desc=v),y&&(q.fext=y),chrome.tabs.sendMessage(e.tabId,q)}}var b=new RegExp("^(("+Y.Bb+")|("+Y.Da+")|("+Y.Ab+"))$","i"),l=/(^(image|audio|video))|(application\/vnd.rn-realmedia)/i;return{start:function(){if(!chrome.webRequest.onHeadersReceived.hasListener(a))try{chrome.webRequest.onHeadersReceived.addListener(a,{urls:["http://*/*","https://*/*"],types:"main_frame sub_frame stylesheet script image font object xmlhttprequest ping csp_report media websocket other".split(" ")},
["responseHeaders"])}catch(e){console.log("Failed to add listener"),console.log(e)}},stop:function(){chrome.webRequest.onHeadersReceived.removeListener(a)}}}();var Z={Ha:0,i:function(){oc=Date.now()/1E3;var a=1==Z.i.N%10;1E4<=Z.i.N++&&(Z.i.N=0);Z.Ib(function(b,l,e){Z.Ha=b;b=[];for(l=0;l<e.length;++l){var q=e[l];b.push(q.id);q._start_time||(q._start_time=oc);q.time_elapsed+=oc-q._start_time;q._start_time=oc;0<q.size&&(q.progress=q.finished_bytes/q.size*100,q.progress=Math.min(100,q.progress),isFinite(q.progress)||console.log("f: "+q.finished_bytes+" sz: "+q.size));q._cf={}}V.B({cmd:"u_prog",ids:b});if(T.get("notify_progress")&&!V.U&&!V.F)for(l=0;l<e.length;++l)ec(e[l]);
if(a)for(l=0;l<e.length;++l)V.g.set(e[l].id)})}};Z.i.N=1;
var W=function(){function a(){for(var n=0,v=V.a.length;n<v;++n){var y=V.a[n];if(y&&0==y.recycled&&y.state==Ra&&!y.O)return y}return null}function b(){if(!l){V.u(!1);var n=a();n&&(l=!0,Z.wb(n,function(v){V.u(v!=Ma);if(v==Na)l=!1;else{if(v==Ma){delete e[n.id];if(!Z.download(n)){l=!1;return}n.O&&(delete n.O,delete q[n.id])}else v==Oa&&(n.O=!0,q[n.id]=n);l=!1;setTimeout(b,0)}}))}}var l=!1,e={},q={};return{Jb:function(){return Object.keys(e).length},enqueue:function(n){e[n.id]=!0},cb:function(n){delete e[n.id]},
V:function(){for(var n in q)delete q[n].O;q={};b()},M:b}}();window.dy_engine=Z;Z.pollProgress=Z.i;Z.getOverallSpeed=function(){return Z.Ha};Z.version=1;
(function(){function a(c){c=c.toLowerCase();return c.endsWith("downloads/")||c.endsWith("download/")?"":"ChronoDownloads/"}function b(c,x){c=l(c);x=l(x);return c==x}function l(c){c=/^(https?|ftp|data):/i.test(c)?c:"http://"+c;return"/"==c[c.length-1]?c:c+"/"}function e(c){c._start_time=Date.now()/1E3;V.l(c,"state",J);N.add(c);Z.i.ka||(Z.i.ka=setInterval(Z.i,1E3),Z.i())}function q(c,x){N.remove(c);0==N.length()&&(clearInterval(Z.i.ka),Z.i.ka=void 0);delete c.H;c._start_time&&(c.time_elapsed+=Math.max(0,
Date.now()/1E3-c._start_time));delete c._start_time;c.active_threads=0;0!=x?chrome.downloads.search({id:c.cr_id},function(G){G&&G.length&&(c.finished_bytes=G[0].bytesReceived);c.state==L?(c.size=c.finished_bytes,c.progress=100):c.progress=0<c.size?c.finished_bytes/c.size*100:0;V.A(c,["progress","size","time_elapsed"])}):V.A(c,["time_elapsed"])}function n(c,x,G){v(x,c.id);c.cr_id=x;D[x]=c;if(0!=G)for(x=aa.find(c.url);x;)c.eurl=x,x=aa.find(x);V.g.set(c.id)}function v(c,x){var G=D[c];G&&G.id!=x&&y(G,
c)}function y(c,x){c.cr_id=-2;V.g.set(c.id);delete D[x]}function u(c){aa.map[l(c.url)]=c.redirectUrl}function p(c){-1!=V.j||V.U?t({cmd:"u_accept",crid:c}):U.h({c:!0},function(){t({cmd:"u_accept",crid:c})})}function h(c){var x=D[c];x&&(y(x,c),N.remove(x),console.log("onerased"))}function B(c){var x=D[c.id];if(x){var G=!1;c.exists&&!c.exists.current&&(G=!0);var M=!1,d=[],k;for(k in c){var m=c[k].current;switch(k){case "url":x.eurl=m;var z="eurl";break;case "filename":m=f(x,m,!1);(z=c.danger?c.danger.current:
"")&&!m&&"safe"!=z&&"accepted"!=z&&p(c.id);z="naming";break;case "mime":x.mime_type=m;break;case "exists":x.exists=m;z="exists";break;case "endTime":x.time_finish=new Date(m);z="time_finish";break;case "state":if(!G){if("interrupted"==m)m=P;else if("complete"==m)m=L;else break;A(x,m)}break;case "error":x.error_str=m;break;case "paused":if(G||c.state)break;1==m?m=Sa:(m=J,x.state!=J&&e(x));A(x,m);break;case "totalBytes":qb(m);case "fileSize":x.size=m;z="size";break;case "danger":c.filename||"safe"==
m||"accepted"==m||p(c.id)}M||("_all_"==z?M=!0:z&&d.push(z))}M?(V.g.set(x.id),yb(x),x._cf={},V.B({cmd:"u_tasks",ids:[x.id]})):0<d.length&&V.A(x,d)}}function H(){var c=T.get("fnconflict");if(0>c||5<=c)c=0;return ja[c]}function r(c,x){if(!Wb.onDeterminingFilename(c,x)){var G=Ub.rb(c.id)||D[c.id];if(!G)console.log("Task not found, could be a canceled to-pause task?");else if(!G.Oa){a:{var M=c.id,d=c.filename;G.file_ext=d;c=Y.bb();!G.naming&&(c=Y.match(G));G.naming||(G.naming=c.naming);c=G.ab();if(Ia(c))var k=
c;else G.naming=d,console.log("naming mask not good, changing to provided:"+d),k=d;!G.folder&&T.get("always_use_last_location")&&(d=Rb.ub())&&(G.folder=d);if(d=Wb.ib()){if(G.folder){const m=Da(G.folder);k=m.startsWith(d)?m.substr(d.length):m;if(k==m){if(eb==T.get("folder_inaccessible")){0>G.cr_id&&(G.cr_id=M);V.ia(G,!0);Ub.pa(G.url,G.referer);G="";break a}k=a(d);G.folder=Ea(d,k)}}else k=a(d),G.folder=Ea(d,k);k=Ea(k,c)}else G.folder="";yb(G);V.A(G,["naming","folder"]);G.Y=Ea(d,k);G=k}G?x({filename:G,
conflictAction:H()}):x()}}}function C(c){function x(M){Z.erase(M,!0);M.reset(J);V.g.set(M.id);K(M);V.B({cmd:"u_tasks",ids:[M.id]})}function G(M){if(0>=M.size)x(M);else{var d=g("confirmCantResumeRestart",[M.s()]);t({cmd:"u_confirm",data:d},function(k){void 0==k&&(k=confirm(d));k?x(M):A(M,P)})}}e(c);void 0==c.cr_id||0>c.cr_id?G(c):chrome.downloads.search({id:c.cr_id},function(M){M&&M.length&&(M[0].canResume||"in_progress"==M[0].state&&!M[0].paused)?chrome.downloads.resume(c.cr_id,function(){}):G(c)})}
function K(c){if(0<=c.cr_id)console.log("dy_engine.newDownload: call restart/resume instead");else{delete c.H;e(c);for(var x=0;x<X.length;++x)if(X[x].id==c.id&&X[x].url==c.url){console.log("duplicate issue!!");return}chrome.downloads.download({url:c.url,method:"GET",saveAs:!1,conflictAction:H()},function(G){if(void 0==G){for(G=0;G<X.length;++G)if(X[G].id==c.id){X.splice(G,1);break}c.cr_id=-2;chrome.runtime.lastError&&chrome.runtime.lastError.message&&(c.error_str=chrome.runtime.lastError.message);
N.has(c.id)&&A(c,P);console.log("fail to start download, "+JSON.stringify(chrome.runtime.lastError))}});X.push(c);return!0}}function E(c,x){void 0==c||0>c?x&&x():chrome.downloads.search({id:c},function(G){G&&G.length&&"complete"==G[0].state&&G[0].exists&&chrome.downloads.removeFile(c,function(){});x&&x()})}function f(c,x,G){var M=!1;if(!c||void 0==c.cr_id||0>c.cr_id)return M;c.full_path=x;const d=c.Y?Fa(Da(c.Y,!1)):["",""];x=Fa(Da(x,!1));let k=!1;if(x[0]!=d[0])c.folder=x[0],console.warn(`folder changed: ${d[0]} => ${x[0]}`);
else if(x[1]!=d[1]){const m=T.get("fnconflict");if(m==cb||m==bb){const z=Aa(d[1]).R||"",F=Aa(x[1]).R||"";F.length>z.length&&0==F.indexOf(z)&&(m==cb?(V.ia(c,!0,"bg"),console.log("file name conflicts: "+d[1]+", removing the task"),t({cmd:"u_skipcancel",filename:d[1]})):m==bb&&(Z.erase(c,!0,!0),c.reset(),c.error_str="fnConflict",A(c,P),console.log("file name conflicts: "+d[1]+", pausing the task")),M=!0)}}else k=!0;M||k||(c.name_conflict=x[1],yb(c),0!=G&&V.A(c,["naming"]),ic(c,x[1]));na("dz","fex",Aa(x[1]||
"").v||"_undefined_");M||(chrome.downloads.getFileIcon(c.cr_id,{size:16},function(m){V.l(c,"iconURL16",m)}),chrome.downloads.getFileIcon(c.cr_id,{size:32},function(m){V.l(c,"iconURL32",m);jc(c,m)}),G=Da(c.folder),qa(G)&&Rb.la(G));c._cf={};V.g.set(c.id);return M}function A(c,x){if(c){var G=c.state;c.state=x;x!=J&&(q(c),W.V(),x==L?G!=x&&fc(c):x==P?G!=x&&hc(c):T.get("notify_progress")&&gc(c));V.A(c,["state"])}}var D={};Z.Xb=function(){for(var c=0;c<V.a.length;++c){var x=V.a[c].cr_id;0<=x&&(D[x]=V.a[c])}chrome.downloads.onChanged.addListener(B);
chrome.downloads.onErased.addListener(h);chrome.downloads.onDeterminingFilename&&chrome.downloads.onDeterminingFilename.addListener(r);chrome.webRequest.onBeforeRedirect.addListener(u,{urls:["http://*/*","https://*/*"]});return!0};var N={},Q={},da={};N.hb=function(c){return da[c]};N.add=function(c){if(c&&c.url){Q[c.id]=!0;var x=ya(c.url).authority;void 0==da[x]&&(da[x]={});da[x][c.id]=!0;V.u(-1)}};N.remove=function(c){if(c){delete Q[c.id];var x=ya(c.url).authority,G=da[x];G&&(delete G[c.id],0==Object.keys(G).length&&
delete da[x]);V.u(-1)}};N.has=function(c){return 1==Q[c]};N.length=function(){return Object.keys(Q).length};var aa={map:{}};aa.nc=setInterval(function(){aa.map={}},3E5);aa.find=function(c){if(0!=c.indexOf("data:")){c=l(c);var x=aa.map[c];return x?(delete aa.map[c],x):null}};Z.Fa=function(){return N.length()};Z.vb=function(c){v(c.id);for(var x=null,G=c.url,M=0;M<X.length;++M)if(b(X[M].url,G)){x=X[M];X.splice(M,1);break}if(!x)return!1;if(x.H)return delete x.H,chrome.downloads.cancel(c.id,function(){chrome.downloads.erase({id:c.id},
function(){A(x,Sa)})}),console.log("ignore a _topause/erased task, cr_id:"+c.id),!0;n(x,c.id);c.referrer&&(x.referer=c.referrer);x.mime_type=c.mime;x.exists=c.exists;V.l(x,"size",c.totalBytes);qb(x.size);return!0};Z.oa=function(c,x,G,M){n(c,x,!M);M||V.qa(c,!1);c.state==J&&e(c);var d=!1;M?(c.full_path=G,V.g.set(c.id)):d=G?f(c,G):!1;c.X&&(d||setTimeout(function(){p(x)},0),delete c.X);0<c.size&&qb(c.size)};var ja=["uniquify","overwrite","prompt","uniquify","uniquify"];Z.download=function(c){if(!c)return!1;
void 0==c.cr_id||0>c.cr_id?K(c):C(c);return!0};Z.pause=function(c){void 0==c.cr_id||0>c.cr_id?c.H=!0:chrome.downloads.pause(c.cr_id,function(){})};var X=[];Z.erase=function(c,x,G,M){q(c,!1);c.H=!0;var d=c.cr_id;void 0==d||0>d||(y(c,d),0!=M&&(x?c.state==L?1!=G?E(d,function(){chrome.downloads.erase({id:d},function(){})}):chrome.downloads.erase({id:d},function(){}):chrome.downloads.cancel(d,function(){chrome.downloads.erase({id:d},function(){})}):chrome.downloads.erase({id:d},function(){})))};Z.xb=function(){var c=
T.get("dy_max_con_tasks");return N.length()<c};Z.wb=function(c,x){var G=T.get("dy_max_con_tasks");if(N.length()>=G)x(Na);else{var M=ya(c.url).authority;chrome.downloads.search({state:"in_progress",urlRegex:"^((https?|ftp)://)?"+M+".*"},function(d){var k=T.get("dy_max_con_tasks");if(N.length()>=k)x(Na);else{k=T.get("dy_max_per_server");var m=!1,z=N.hb(M),F=z?Object.keys(z):[];z={};if(F&&F.length)for(var I=0;I<F.length;++I)z[F[I]]=!0;F=Object.keys(z).length;if(d&&d.length){var S=-10;for(I=0;I<d.length;++I){var O=
D[d[I].id];O=O?O.id:S--;z[O]=!0}}if(Object.keys(z).length<k||F<k&&1==z[c.id])m=!0;x(m?Ma:Oa)}})}};Z.Ib=function(c){chrome.downloads.search({state:"in_progress",paused:!1},function(x){var G=0,M=x.length,d=[];if(x.length){var k=x.length;k=10<k?10:5<k?5:3;for(var m=Z.i.N%k,z=0;z<x.length;++z){var F=x[z],I=F.id,S=F.bytesReceived,O=F.totalBytes-S,sa=.001*(new Date(F.estimatedEndTime)).getTime(),pb=sa-oc,Qa=0;0<O&&0<pb&&(Qa=O/pb,G+=Qa);I%k==m&&(I=D[I])&&(I.speed=Qa,I.finished_bytes=S,I.time_remained=void 0==
F.estimatedEndTime?8553600:sa-oc,d.push(I))}c(G,M,d)}else c(G,M,[])})};Z.oc=function(){};Z.sc=function(c){c(1)}})();Z.numDownloading=Z.Fa;Z.erase=Z.erase;Z.pause=Z.pause;let $b=(()=>{function a(b,l){if(!b)return l&&l(!1,g("errorFileNotExist")),!1;if(!(0<=b.cr_id))return l&&l(!1,g("errorRemovedFromChrome")),!1;chrome.downloads.search({id:b.cr_id},function(e){var q=!0,n="";e&&e.length?(b.exists!=e[0].exists&&V.l(b,"exists",e[0].exists),b.exists||(q=!1,n=g("errorFileNotExist"))):0<b.time_elapsed&&(q=!1,n=g("errorRemovedFromChrome"));l&&l(q,n)});return!0}return{eb:function(b,l){a(b,l)&&(b=chrome.downloads.show(b.cr_id),chrome.runtime.lastError&&console.log(`explore ${b} lastError: '${JSON.stringify(chrome.runtime.lastError)}'`))},
exec:function(b,l){a(b,l)&&(b=chrome.downloads.open(b.cr_id),chrome.runtime.lastError&&console.log(`exec ${b} lastError: '${JSON.stringify(chrome.runtime.lastError)}'`))}}})();var Vb=function(){function a(e){switch(e.cmd){case "open_ui":U.h();break;case "open_options":case "open_set":U.T({})}}function b(e,q){e.url=e.url.replace(/ /g,"%20");var n=e.url;n=n||"";var v=0==n.indexOf("data:"),y=n.indexOf("\r");-1==y&&(y=n.indexOf("\n"));-1!=y?n=n.substr(0,v?Math.min(y,1024):y):v&&1024<n.length&&(n=n.substr(0,1024));if(v?!ua.test(n):!va.test(n))return console.log("bad url in new_task()"),console.log(e.url),null;0==/^(https?|ftp|data):/i.test(e.url)&&(e.url="http://"+e.url);n=
V.$(e.url,e.referer);if(!n)return-1;n.naming=e.naming;e.folder&&(n.folder=e.folder);n.text=e.text||"";n.title=e.title||"";n.desc=e.desc;n.page_title=q;n.max_threads_config=5;n.naming&&Sb.la(n.naming);return n}function l(e,q,n){switch(e.cmd){case "open_ui":U.h({c:e.activate,o:e.tabId});n("y");break;case "open_options":U.T({W:e.section,C:e.uiWinId,L:e.pos});break;case "clear_noty":e.tid?kc(e.tid):e.type&&Pb(e.type);break;case "reschedule":W.V();break;case "blog":console.log(e.data);break;case "path_list_recents":n({list:Rb.Ba()});
break;case "path_list_favs":n({list:T.get("path_fav")||[]});break;case "fav_path":1==e.fav?T.Ja("path_fav",e.path):T.Ka("path_fav",e.path);break;case "naming_list":n({list:Sb.Ba()});break;case "dlg_options":n({fontSize:T.get("font_size"),useLastLocation:T.get("always_use_last_location"),taskDef:T.J(),canFileAccess:T.canFileAccess()});break;case "browser_home_path_normalized":return Wb.ob().then(E=>{n(E)}),!0;case "save_as":e=Ba(e.url);Ub.pa(e);break;case "new_task":if(e.tasks){var v=q=!1,y=e.add_paused,
u=e.addtop,p=e.page_title,h=V.a.length+10,B=e.notify&&T.get("notify_oneclick");const E=[];for(var H=0,r=e.tasks.length;H<r;++H){var C=b(e.tasks[H],p);if(-1==C){q=!0;break}else if(null!=C){y||(C.state=Ra,W.enqueue(C),v=!0);var K=V.ha(C,u,!y);K<h&&(h=K);E.push(C)}}dc(E);if(B)for(p=0;p<E.length;p++)cc(E[p],y);na("fe_us","dl_src",e.source||"unkown",e.tasks.length||1);h<V.a.length&&(t({cmd:"u_new",idx:h,addtop:u,scroll_id:V.a[u?0:V.a.length-1].id}),V.Ta(),v&&W.M());q&&U.h({c:!0},function(){t({cmd:"u_alert",
data:kb.noID})})}n("y");break;case "url_desc":Ub.Ub(e.url,e.download,e.text,e.title,e.page_title||(q.tab?q.tab.title:""));break;case "poll_progress":Z.i();break;case "import":if("chrome"==e.src)return V.yb(n),!0}}return{wa:function(){return a},ba:function(){return l}}}();let Wb=(()=>{function a(r,C,K){const E=new Promise(f=>{H=setTimeout(K,C,f)});return Promise.race([r,E])}function b(){if(p)return p;n||(chrome.downloads.onCreated.addListener(l),chrome.downloads.onChanged.addListener(q),n=!0);B=Date.now();return p=a(new Promise(r=>{h=r;chrome.downloads.download({url:v,filename:"This is Chrono testing download configuration, please click Cancel. You shouldnt see this unless the default downloads location is set to a non-savable folder (like system folder).txt",method:"GET",
saveAs:!1,conflictAction:"overwrite"},function(C){u=C})}),1500,r=>{h&&console.error("timeout");r("")}).then(r=>{y=r;T.set("downloads_home",y);e();return r})}function l(r){B&&r.url==v&&new Date(r.startTime)>=B&&(u=r.id,B=0)}function e(){const r=u;u=void 0;B=0;H&&clearTimeout(H);h=p=H=void 0;r&&chrome.downloads.cancel(r,()=>{chrome.downloads.erase({id:r},()=>{})})}function q(r){u&&u==r.id&&(r.error&&"USER_CANCELED"==r.error.current||r.state&&"interrupted"==r.state.current?h&&h(""):r.filename&&r.filename.current&&
(r=Da(Ha(r.filename.current)),h&&h(r)))}let n=!1,v=chrome.extension.getURL("bg/chrono_testing.txt"),y="",u,p,h,B=0,H;return{Na:v,ob:b,ib:()=>{b();return y},onDeterminingFilename:function(r,C){return u&&r.id==u?(C({filename:"This is Chrono testing download configuration, please click Cancel. You shouldnt see this unless the default downloads location is set to a non-savable folder (like system folder).txt",conflictAction:"overwrite"}),!0):!1}}})();var oc=Date.now()/1E3,V={jc:window.location.href,j:-1,Ia:-1,U:!1};
(function(){function a(d){for(var k=V.a.length,m=0;m<k;++m)if(V.a[m].id==d)return m;return-1}function b(){t({cmd:"u_updated",data:A})}function l(d,k){return d[0]-k[0]||d[1]-k[1]||d[2]-k[2]}function e(d){d=d.split(".");for(var k=Array(3),m=0;m<d.length&&3>m;++m){var z=parseInt(d[m]);if(isNaN(z)||!isFinite(z))z=0;k[m]=z}for(;3>m;++m)k[m]=0;return k}function q(d){d=e(d);if(0>l(d,[0,7,3]))for(var k in T.items)if(0==k.indexOf("tip_")&&"tip_rateshare"!=k&&"tip_translate"!=k){var m=T.items[k];0<m.value&&
(m.value=100,localStorage["#"+k]=m.value)}l(d,[0,9,0]);0>l(d,[0,10,0])&&T.set("tip_translate",0);console.log("onVerUpdated process")}function n(){function d(k){var m=nb(k);if(m){var z=m._t;if(z&&(z=Math.round(Math.max(0,(Date.now()-z)/864E5-.1999)),!(1>z))){var F=Object.keys(m).length,I;for(I in m)if("_t"!=I){var S=Math.round(m[I]/z);if(isNaN(S)||!isFinite(S))S=0;var O=I.split(";");ha(["_trackEvent",k,O[0],O[1],S,!0],F)}la.removeItem(mb+k)}}}(function(){var k=Date.now(),m=T.get("_glst");if(!m)T.set("_glst",
k);else if(!(1>Math.round(Math.max(0,(k-m)/864E5-.1999)))){m=T.get("downloads_home")||"";var z=["ui_mode",1==T.get("ui_grid_list")?"list":"table"];var F=T.get("bg_image_enable")?(F=T.get("bg_image_url"))?"#"==F[0]?"color":F.startsWith("../")||F.startsWith("chrome-extension://")?"builtin":"url":"unknown":"disabled";ka([z,["bg_theme",F],["search_mode",""+T.get("search_mode")],["fnconflict",""+T.get("fnconflict")],["override_cr",""+T.get("override_cr")],["dbclick_action",""+T.get("dbclick_action")],
["oneclick_enabled",""+T.get("doneclick_rule")],["slide_details_panel",""+T.get("slide_details_panel")],["pop_ing_first",""+T.get("poplist_showd_first")],["custom_naming",""+("*name*.*ext*"!=T.get("def_naming"))],["match_mode",""+T.get("match_mode")],["autoclear",0<T.get("autoclear_timer")?T.get("autoclear_type"):"disabled"],["use_last_folder",""+T.get("always_use_last_location")],["folder_inaccessible",""+T.get("folder_inaccessible")],["#home_lev",void 0,m.slice(1).split("/").length-1],["homeD",
m[0]||"!"],["#task_n",void 0,V.a.length],["#pop_max_items",void 0,T.get("poplist_max_items")],["#max_con_tasks",void 0,T.get("dy_max_con_tasks")],["#max_per_server",void 0,T.get("dy_max_per_server")],["file_access",""+V.P]]);T.set("_glst",k)}})();d("fe_us");d("dz");d("sf")}function v(){var d=/((ftp)|(https?)):\/\/.+/;chrome.windows.getAll({populate:!0},function(k){var m=["cs/sniffer.js","cs/main.js"];var z=[!0,!1];for(var F=0;F<k.length;F++)for(var I=k[F].tabs,S=0;S<I.length;S++)if(d.test(I[S].url))for(var O=
0;O<m.length;++O)chrome.tabs.executeScript(I[S].id,{file:m[O],allFrames:z[O]},function(){chrome.runtime.lastError&&console.log(chrome.runtime.lastError)})})}function y(){T.load();Rb.load([T.get("def_folder")]);var d=["*page_title*.*ext*","*title*.*ext*","*text*.*ext*","*name*.*ext*"];d.push(T.get("def_naming"));Sb.load(d);K&&q(K);chrome.downloads.setShelfEnabled&&chrome.downloads.setShelfEnabled(0==T.get("hide_cr_bar"));Ub.start();nc.start();T.get("override_cr")&&U.ga(!0);chrome.tabs.onActivated.addListener(function(k){chrome.tabs.get(k.tabId,
function(m){V.F=m&&0==m.url.indexOf(U.zb);V.F&&T.get("notify_progress")&&Pb("task_")})});chrome.windows.onFocusChanged.addListener(function(k){-1!=V.j?chrome.tabs.get(V.j,function(m){chrome.runtime.lastError?V.F=!1:(V.F=m&&m.windowId==k&&m.active,V.F&&T.get("notify_progress")&&Pb("task_"))}):V.F=!1});1==T.get("pop_content")?(chrome.browserAction.setPopup({popup:"/pop/sniffer.htm"}),chrome.browserAction.setTitle({title:g("tipBrowserAction")})):(chrome.browserAction.setPopup({popup:"/pop/pop.htm"}),
chrome.browserAction.setTitle({title:g("extName")}));Hb.Qa();chrome.runtime.onMessage.addListener(Vb.ba());chrome.runtime.onMessageExternal.addListener(Vb.wa());Tb.$b();E&&U.h({c:!0},function(){b();f=!0});chrome.webRequest.onBeforeRequest.addListener(function(){return{cancel:!0}},{urls:[V.jc+"*"]},["blocking"]);v();chrome.runtime.requestUpdateCheck&&(setTimeout(function(){chrome.runtime.requestUpdateCheck(function(){})},3E4),setInterval(function(){chrome.runtime.requestUpdateCheck(function(){})},
18E6));W.M();(function(){for(var k=[],m=Y.za(),z=0;z<m.length;++z)if(m[z].as_filter){var F=Xb.compile(m[z].condition);F&&(k.push(m[z].condition),k.push(F))}M.add(function(I,S){I._cf||(I._cf={});for(var O=0;O<S.length;O+=2)if(void 0==I._cf[S[O]])try{I._cf[S[O]]=Xb.dc(S[O+1],I)}catch(sa){console.log("Invalid filter expression: "+sa)}},V.a,200,!1,0,k)})();chrome.alarms.clear("auto-clear-tasks",function(){var k=T.get("autoclear_type"),m=T.get("autoclear_timer");r(k,m)&&(k=T.get("autoclear_lasttime"),
-1==k&&(k=Date.now(),T.set("autoclear_lasttime",k)),k=m-Math.max(0,Date.now()-k)/6E4,k=Math.max(1,Math.ceil(k)),chrome.alarms.create("auto-clear-tasks",{delayInMinutes:k,periodInMinutes:m}),console.log("auto_clear will run in "+k+" mins"))});console.log("done");V.isInited=!0}function u(d){t({cmd:"u_hi"},function(k){"hi"==k?(console.log("ui connected"),d&&d()):(console.log("connecting to ui, try again"),u(d))})}function p(d){if(!d.filename)return null;var k=V.$(d.url,d.referrer);if(!k)return-1;let m=
d.filename;k.full_path=m;k.naming="*name*.*ext*";k.file_ext=Ga(m);k.folder=Ha(m);k.finished_bytes=d.bytesReceived;k.size=d.fileSize||d.totalBytes;k.exists=d.exists;k.uc=d.mime;k.time_add=new Date(d.startTime);d.endTime&&(k.time_finish=new Date(d.endTime),k.time_elapsed=(k.time_finish-k.time_add)/1E3);d.error&&(k.error_str=d.error);k.state=Sa;"in_progress"==d.state?d.paused||(k.state=J):"complete"==d.state?k.state=L:"interrupted"==d.state&&(k.state=P);k.state==L?(k.size=k.finished_bytes,k.progress=
100):k.progress=0<k.size?k.finished_bytes/k.size*100:0;"safe"!=d.danger&&"accepted"!=d.danger&&(k.X=!0);return k}function h(){aa=!0;V.B=function(){}}function B(){V.B=t;aa=!1}function H(){c+=1/36;ja.save();ja.clearRect(0,0,16,16);ja.translate(8,8);ja.rotate((1-Math.sin(Math.PI/2+c*Math.PI))/2*Math.PI*2);ja.drawImage(X,-8,-8);ja.restore();chrome.browserAction.setIcon({imageData:ja.getImageData(0,0,16,16)});1>=c?setTimeout(H,10):(c=0,chrome.browserAction.setIcon({path:"../icons/logo/16.png"}))}function r(d,
k){x=void 0;G&&(clearTimeout(G),G=void 0);if(0>k)return!1;var m=6E4*k;switch(d){case "finished":var z=function(F){return F.state==L&&Date.now()-F.time_add>m};break;case "interrupted":z=function(F){return F.state==P&&Date.now()-F.time_add>m};break;case "both":z=function(F){return(F.state==L||F.state==P)&&Date.now()-F.time_add>m};break;default:return!1}console.log("setup auto_clear: "+d+", "+k+" mins, now: "+(new Date).toLocaleString());x=z;return!0}V.P=!0;chrome.extension.isAllowedFileSchemeAccess(function(d){V.P=
d});var C=new ba(9999);V.g=new ba(9999);V.a=[];V.nb=function(){return V.a};V.qb=function(d){d||(d=15);for(var k=[],m=V.a.length,z=0;z<m;++z)V.a[z].recycled||k.push(z);T.get("poplist_showd_first")?k.sort(function(F,I){F=V.a[F];I=V.a[I];return F.state==I.state?I.time_add-F.time_add:F.state<=Ta?F.state-I.state:I.state<=Ta?1:I.time_add-F.time_add}):k.sort(function(F,I){return V.a[I].time_add-V.a[F].time_add});return k.slice(0,d)};V.ja=function(d){d=a(d);return-1==d?null:V.a[d]};chrome.runtime.onUpdateAvailable.addListener(function(d){ac(d.version)});
var K,E=!1,f=!1,A=!1;(function(){var d=localStorage.ver,k=chrome.runtime.getManifest().version,m=!1,z=d||k;localStorage.ver1&&localStorage.ver1_t||(localStorage.ver1=z,localStorage.ver1_t=Date.now());if(d){z=e(d);var F=e(k);z[2]=F[2]=0;0>l(z,F)&&(m=!0);d!=k&&(K=d)}else m=A=!0;m&&(E=!0,f&&b());localStorage.ver=k})();window.addEventListener("load",function(){Tb.open(function(){Tb.fb(function(d){for(var k=0;k<d.length;++k){var m=d[k];C.set(m.id);m.state==J&&(m.state=Ra,V.g.set(m.id),W.enqueue(m));-1==
m.cr_id&&(m.cr_id=-2)}V.a=d;Z.Xb()&&(y(),setTimeout(n,8E3))})})});window.onunload=function(){chrome.runtime.onMessage.removeListener(Vb.ba());chrome.runtime.onMessageExternal.removeListener(Vb.wa());Tb.bc();Rb.commit();Sb.commit();Ub.stop();nc.stop();U.ga(!1);Tb.commit(Tb.close)};var D=[];V.Tb=function(d){D.push(d)};var N=1;V.ic=function(d){-1!=V.j?(console.warn("closing ui tab "+V.j),chrome.tabs.remove(V.j,()=>{V.Ma(d)})):V.Ma(d)};V.Ma=function(d){V.j=d;u(function(){for(;0<D.length;)D.shift()()});
d=new XMLHttpRequest;d.open("GET","https://www.chronodownloader.net?i="+N++,!0);d.send()};V.hc=function(){V.j=-1;console.log("ui disconnected")};V.yb=function(d){function k(m){chrome.downloads.getFileIcon(m.cr_id,{size:16},function(z){chrome.runtime.lastError||V.l(m,"iconURL16",z)});chrome.downloads.getFileIcon(m.cr_id,{size:32},function(z){chrome.runtime.lastError||(V.l(m,"iconURL32",z),m.state==J&&jc(m,z))})}chrome.downloads.search({},function(m){if(m&&m.length){h();for(var z=V.a.length+10,F=0;F<
m.length;++F){var I=p(m[F]);if(I){if(-1==I){U.h({c:!0},function(){t({cmd:"u_alert",data:kb.noID})});break}Z.oa(I,m[F].id,m[F].filename,!0);I=V.ha(I,!1,!1);I<z&&(z=I)}}B();z<V.a.length&&(t({cmd:"u_new",idx:z,scroll_id:V.a[V.a.length-1].id}),m=V.a.slice(z),m.reverse(),M.add(k,m,15,!1,100))}d&&d()})};var Q,da=0;V.u=function(d){if(!aa&&!Q){var k=Date.now(),m=da;da=k;500>k-m?Q=setTimeout(function(){Q=void 0;V.u(-1)},500):(k="",T.get("badge_downnum")&&(m=Z.Fa(),99<m?k="99+":0<m&&(k=m.toString(),-1==d&&
(d=0<W.Jb()),d&&(k+="+"))),chrome.browserAction.setBadgeText({text:k}))}};V.B=t;var aa=!1;V.A=function(d,k,m){V.g.set(d.id);d._cf={};0!=m&&V.B({cmd:"u_fields",id:d.id,fields:k})};V.l=function(d,k,m,z){d[k]=m;V.A(d,[k],z)};var ja=document.createElement("canvas").getContext("2d");var X=new Image;X.src="../icons/logo/16.png";var c=0;V.Ta=H;V.qa=function(d,k){var m=T.J().addtop,z=V.ha(d,m,!k);V.B({cmd:"u_new",ids:[d.id],idx:z,addtop:m,scroll_id:d.id});U.ya(function(F){chrome.tabs.sendMessage(F.id,{cmd:"d_anim",
addpause:k})});H();T.get("notify_oneclick")&&cc(d,k);na("fe_us","dl_src","chrome")};V.$=function(d,k){var m=new R;m.id=C.Ea(!0);if(-1==m.id)return null;m.referer=k||"";m.eurl=m.url=d;return m};V.ha=function(d,k,m){if(!d)return-1;d.naming_auto=!d.naming;!m&&d.folder&&(m=Da(d.folder),qa(m)&&Rb.la(m,d.time_add));k?(V.a.unshift(d),k=0):(V.a.push(d),k=V.a.length-1);V.g.set(d.id);return k};V.Zb=function(d){d||(d=V.a);var k=-1234;T.get("start_interrupted")&&(k=P);for(var m=[],z=0,F=d.length;z<F;++z){var I=
d[z];if(I.state==Sa||I.state==k)V.l(I,"state",Ra,!1),W.enqueue(I),m.push(I.id)}m.length&&(W.M(),t({cmd:"u_tasks_by_field",ids:m,field:"state"}))};V.ac=function(d){d||(d=V.a);for(var k=[],m=0,z=d.length;m<z;++m){var F=d[m];F.state==Ra?(V.l(F,"state",Sa,!1),W.cb(F),k.push(F.id)):F.state==J&&(Z.pause(F),k.push(F.id))}k.length&&(t({cmd:"u_tasks_by_field",ids:k,field:"state"}),W.V())};V.Sb=function(d){d||(d=V.a);var k=!1,m=[];h();for(var z=0,F=d.length;z<F;++z){var I=d[z];Z.erase(I,!0);I.reset();I.state==
J?Z.download(I):(I.state=Ra,W.enqueue(I),k=!0);m.push(I.id);I._cf={};V.g.set(I.id)}B();k&&W.V();t({cmd:"u_tasks",ids:m})};V.ia=function(d,k,m){d.state==Ra&&(d.state=Sa);Z.erase(d,k);C.clear(d.id);V.g.clear(d.id);Tb.Ob(d.id);k=a(d.id);-1!=k&&V.a.splice(k,1);setTimeout(function(){kc(d.id)},200);m&&t({cmd:"u_clear",src:m})};V.Qb=function(d,k,m){h();for(var z=0,F=d.length;z<F;++z){var I=d[z];I.state==Ra&&(I.state=Sa);Z.erase(I,k);C.clear(I.id);V.g.clear(I.id)}B();M.add(Tb.Pb,d,200,!0);M.add(lc,d,50,!1,
150);m&&t({cmd:"u_clear",src:m,count:1<d.length?d.length:0})};V.xa=function(d){for(var k=[],m=V.a.length-1;0<=m;--m)d(V.a[m])&&k.push(m);return k};V.Ya=function(d){return V.ra(V.xa(d),!1,"bg")};V.ra=function(d,k,m){if(!d||!d.length)return 0;console.log("Begin clearing tasks");var z=!1,F=[];h();for(var I=0;I<d.length;++I){var S=d[I],O=V.a[S];z||O.state!=J&&O.state!=Ra||(z=!0);Z.erase(O,k);C.clear(O.id);V.g.clear(O.id);F.push(O.id);V.a.splice(S,1)}B();M.add(Tb.Nb,F,200,!0);M.add(kc,F,50,!1,150);t({cmd:"u_clear",
count:F.length,src:m});z&&V.u(-1);console.log(F.length+" task(s) cleared");return F.length};var x,G;V.Vb=function(d,k){chrome.alarms.clear("auto-clear-tasks",function(){T.set("autoclear_type",d);T.set("autoclear_timer",k);r(d,k)?(T.set("autoclear_lasttime",Date.now()),chrome.alarms.create("auto-clear-tasks",{delayInMinutes:k,periodInMinutes:k})):console.log("autoclear disabled")})};chrome.alarms.onAlarm.addListener(function(d){d&&"auto-clear-tasks"==d.name&&x&&(d={type:"basic",title:g("tipBtnClear"),
priority:1,message:g("statusScheduledAutoClear",[60]),contextMessage:"@"+(new Date(Date.now()+6E4)).toLocaleString(),iconUrl:"../icons/logo/48.png"},chrome.notifications.create("int_auto_clear",d,function(){}),G&&(clearTimeout(G),G=void 0),G=setTimeout(function(){if(x){var k=V.Ya(x);T.set("autoclear_lasttime",Date.now());0<k&&(k={type:"basic",title:g("tipBtnClear"),priority:1,message:g("statusTasksCleared",[k]),iconUrl:"../icons/logo/48.png"},chrome.notifications.create("int_auto_clear",k,function(){}))}},
6E4))});V.reset=function(){h();for(var d=0;d<V.a.length;++d)Z.erase(V.a[d],!1,!0,!1);V.a.splice(0,V.a.length);d=localStorage.ver1;var k=localStorage.ver1_t;localStorage.clear();d&&(localStorage.ver1=d);k&&(localStorage.ver1_t=k);Tb.clear(function(){chrome.runtime.reload()})};V.Cb=function(){return M.Va()};var M=function(){function d(){m=void 0;if(k.length){var z=k[0];if(z.Ua)z.ua(z.p.slice(z.K,z.K+z.Z),z.ta);else for(var F=z.K,I=F+z.Z;F<I&&F<z.La;++F)z.ua(z.p[F],z.ta);(z.K+=z.Z)>=z.La&&k.shift();
k.length?m=setTimeout(d,k[0].iv):(t({cmd:"u_bgbusy",data:!1}),console.log("work queue empty"))}}var k=[],m;return{add:function(z,F,I,S,O,sa){O=O||150;k.push({ua:z,p:F,La:F.length,Z:I,Ua:S,iv:O,K:0,ta:sa});m||(m=setTimeout(d,O),t({cmd:"u_bgbusy",data:!0}))},Va:function(){return void 0!=m||0<k.length}}}()})();V.canFileAccess=function(){return V.P};V.setPopListOpen=function(a){V.U=a};V.isPopListOpen=function(){return V.U};V.setPopSnifferTabId=function(a){V.Ia=a};V.getUITabId=function(){return V.j};
V.getRecents=V.qb;V.getDatas=V.nb;V.task_by_id=V.ja;V.start_tasks=V.Zb;V.stop_tasks=V.ac;V.restart_tasks=V.Sb;V.remove_tasks=V.Qb;V.remove_task_completely=V.ia;V.clear_tasks=V.ra;V.getFilteredTaskIndices=V.xa;V.reset=V.reset;V.update_field=V.l;V.set_auto_clear=V.Vb;V.isBusy=V.Cb;V.ui_ready=V.ic;V.ui_close=V.hc;window.dy_bkg=V;
