'use strict';window._gaq=window._gaq||[];window._gaq.push(["_setAccount","UA-32450437-3"],["_setDetectFlash",!1],["_setDetectTitle",!1],["_trackPageview"]);const aa={ss:300,dz:250,fe_us:150,sf:150,sets:100,stats:50},ba={sets:5,stats:5},ha={sets:{o:0,l:0},stats:{o:0,l:0}};
function ia(){const e=ba.stats;if(e){var g=ha.stats;if(g){var k=Date.now();864E5<k-(g.l||0)&&(g.l=k,g.o=0);g.o++>=e||(g=["_trackEvent","stats","error","noHome",void 0,void 0],e&&(k=aa[g[1]])&&Math.floor(4E3*Math.random()*e)<k&&(g[1]+=`[${k}][1:${4}]`,g[2]+=`[1:${e}]`,window._gaq.push(g)))}}}
window.addEventListener("load",function(){if(1==window._ga_ssl_with_xhr_chrono_){var e=new XMLHttpRequest;e.open("GET","https://ssl.google-analytics.com/ga.js",!0);e.onreadystatechange=function(){if(4==e.readyState&&200==e.status)try{eval((e.responseText||"").replace("http://www.google-analytics.com","https://ssl.google-analytics.com"))}catch(k){console.log(k)}};e.send()}else{var g=document.createElement("script");g.type="text/javascript";g.async=!0;g.src="https://ssl.google-analytics.com/ga.js";
document.body.appendChild(g)}});var ma=localStorage;var na="undefined"!==typeof InstallTrigger,pa=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!==typeof safari&&safari.W).toString(),qa=!!document.documentMode,ra=!qa&&!!window.T,sa="FF"==(window.F&&window.F.S||window.opera||0<=navigator.userAgent.indexOf(" OPR/")?"OPERA":na?"FF":pa?"SAFARI":qa?"IE":ra?"EDGE":"CHROME")?"about:addons":`chrome://extensions/?id=${chrome.runtime.id}#allow-on-file-urls`;var l=chrome.i18n.getMessage,ta=chrome.runtime.sendMessage;function ua(e){chrome.tabs.create({url:"chrome://settings/downloads"});t("change_downloads_folder",e)}function va(){chrome.tabs.create({url:sa})}function I(e){return e?e.trim():""}var wa=/^data:([^;]+)((?:;[^=]+=[^;]+)*)(?:;(base64))?,(.+)$/,xa=/^(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i;
function ya(e){e=e||"";var g=0==e.indexOf("data:"),k=e.indexOf("\r");-1==k&&(k=e.indexOf("\n"));-1!=k?e=e.substr(0,g?Math.min(k,1024):k):g&&1024<e.length&&(e=e.substr(0,1024));return g?wa.test(e):xa.test(e)}function za(e,g){return e.replace(/[\/\\]+$/g,"").replace(/[\/\\]+/g,"/").trim()+(0==g?"":"/")}function Aa(e,g){return e?g?e.replace(/[\/\\]+$/,"")+"/"+g.replace(/[\/\\]+$/,""):e:g}function L(e){return e.replace(/[\/\\]+/g,0==navigator.platform.indexOf("Win")?"\\":"/")}
function Ba(e){let g=0;"/"==e[e.length-1]&&(g=1);let k=e.lastIndexOf("/",e.length-1-g)+1;return[e.substring(0,k),e.substring(k,Math.max(k,e.length-g))]}
function Ca(e,g){let k=e.split("/");var q=0,u=k.length-1;k[0]||++q;k[u]||--u;if(u<q)return e;e=q+1;var w=u-1;for(q=k[q].length+k[u].length;e<=w&&q<g;){u=Math.min(k[e].length,k[w].length);if(3<u&&q+u>g)break;q+=u;k[e].length<k[w].length?++e:--w}e<=w&&k.splice(e,w-e+1,"...");e=k.length-1-!k[k.length-1];w=k[e];--g;w.length>g?(g=Math.floor(g/2),g=w.slice(0,g)+"..."+w.slice(w.length-g)):g=w;k[e]=g;return k.join("/")}var Q=0;Q=0;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;Q++;Q++;Q=0;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;
Q=0;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;Q++;Q=0;Q++;Q++;Q=0;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q++;Q=0;Q++;Q++;Q++;Q=0;Q++;Q=256;Q++;Q++;Q++;Q++;Q++;Q++;Q=512;Q++;Q++;l("chromesysFailedGenericNetworkError");l("chromesysFailedGenericDownloadError");l("stateDownloading");l("stateQueue");l("statePaused");l("stateFinished");l("stateError");l("stateFileMiss");l("errorNone");l("errorFNameConflict");l("errorNoID");function Da(e,g,k){chrome.runtime.sendMessage({cmd:g},function(q){if(q&&q.list){k=k||{};const A=document.getElementById(e);for(;A.lastElementChild;)A.removeChild(A.lastElementChild);for(var u=0,w=q.list.length;u<w;++u){let K=q.list[u];if(!K)continue;let G;k.process?G=k.process(K):(G=document.createElement("option"),G.setAttribute("value",K));G&&A.appendChild(G)}k.j&&k.j(A)}})}function Ea(e){e.bind("keydown.escape_focus",function(g){27==g.keyCode&&$(this).blur()})};function Fa(){function e(g,k){g="i18n-"+g;for(var q=document.querySelectorAll("["+g+"]"),u=0;u<q.length;++u){var w=l(q[u].attributes[g].value);q[u][k]=w;q[u].removeAttribute(g)}}e("text","innerText");e("title","title");e("href","href");e("placeholder","placeholder");(function(g,k){g="i18n-"+g;for(var q=document.querySelectorAll("["+g+"]"),u=0;u<q.length;++u){var w=l(q[u].attributes[g].value);q[u].setAttribute(k,w);q[u].removeAttribute(g)}})("tooltip","data-tooltip");(function(g,k){g="i18n-"+g;for(var q=
document.querySelectorAll("["+g+"]"),u=0;u<q.length;++u){var w=q[u].attributes[g].value.split(","),A=w[0];w.shift();w=l(A,w);q[u][k]=w;q[u].removeAttribute(g)}})("textparams","innerText");"undefined"!=typeof bg_settings&&Ga()}
function Ga(){var e=bg_settings.get("font_size");document.documentElement.classList.contains("fs-none")||(document.documentElement.style.fontSize&&document.documentElement.classList.remove("fs-"+document.documentElement.style.fontSize),document.documentElement.style.fontSize=e+"px",document.documentElement.classList.add("fs-"+e+"px"))};const Ha=["",[String.fromCharCode(103),String.fromCharCode(108),String.fromCharCode(99)].join(""),"1_"].join("_");function Ia(){var e=void 0;var g=ma[Ha+"fe_us"];if(void 0!=g)try{e=JSON.parse(atob(g[1]+g.substr(3)))}catch(k){}g=Date.now();return!e||!e._t||isNaN(e._t)||!isFinite(e._t)||6048E5<g-e._t?{_t:g}:e}
function t(e,g){function k(w){return btoa(w.split("").map(A=>{var K=A.charCodeAt(0),G=0;"_"!=A&&(G=60<K?-55:53);return String.fromCharCode(K+G)}).join(""))}var q=q||1;var u=Ia();e=k(e)+(g?";"+k(g):"");u[e]=(u[e]||0)+q;(function(w,A){A=btoa(JSON.stringify(A));ma[Ha+w]=String.fromCharCode(97+Math.floor(26*Math.random()))+A[0]+String.fromCharCode(97+Math.floor(26*Math.random()))+A.substr(1)})("fe_us",u)};document.oncontextmenu=function(e){var g=e.target.nodeName.toLowerCase(),k=e.target.type&&e.target.type.toLowerCase();if(!e.target.classList.contains("allow-ctx-menu")&&(e.target.disabled||"textarea"!=g&&("input"!=g||"text"!=k&&"number"!=k)))return!1};
let Ja,W=(()=>{function e(b){return(b=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(location.href))?b[1]:void 0}function g(b,a,d,c){R=c&&document.activeElement;let f=document.getElementById("error_msg");D||(D=new mdc.snackbar.MDCSnackbar(f),f.addEventListener("MDCSnackbar:closed",function(h){R&&document.activeElement==f&&R.focus();"action"==h.detail.reason&&X.action&&X.action()}));b?(X=d||{},D.labelText=b,D.timeoutMs=a||4E3,X.text?(D.closeOnEscape=!0,f.classList.remove("no-action"),f.querySelector(".mdc-snackbar__action .mdc-button__label").innerText=
X.text):(D.closeOnEscape=!1,f.classList.add("no-action")),D.open(),c&&f.focus()):D.close()}function k(b){b[0]&&(b=b[0]._mdc_obj_)&&(b.valid=!1)}function q(b,a,d){b[0]&&void 0!=a&&(b=b[0]._mdc_obj_)&&(b[d||"value"]=a)}function u(b){function a(){return d.menu&&d.menu.items&&0!=d.menu.items.length?d.menu.items[0].classList.contains("mdc-list-item--disabled")?null:d.getSelectAdapterMethods().getMenuItemValues()[0]:null}const d=b&&b._mdc_obj_;if(!d)throw"MDC select failed to initialize";d.menu.quickOpen=
!0;b.addEventListener("MDCSelect:change",function(c){ja.val(c.detail.value);console.log("folder=>: "+c.detail.value)});Ea($(d.selectAnchor));d.menuElement.addEventListener("MDCMenuSurface:opened",function(){this.focus()});return{J:()=>d,K:function(){let c=b&&b._mdc_obj_;return c?c.value:""},B:function(c){const f=d.getSelectAdapterMethods().getMenuItemValues();for(let h=0;h<f.length;h++)if(f[h]==c){d.selectedIndex!=h&&(d.selectedIndex=h);return}document.getElementById("folder-select-list").prepend(K(c,
!1));d.layoutOptions();d.selectedIndex=0},U:a,R:function(){return d.menu&&d.menu.items&&0!=d.menu.items.length?a()?(d.selectedIndex=0,!0):!1:!1}}}function w(b){A(b)&&N()}function A(b){var a=v.find("form").N(),d=I(a.folder),c=(a.naming||"").trim().replace(/(^(\\|\/|\.)+)|((\\|\/|\.)+$)/g,"").replace(/\s*(\\|\/)+\s*/g,"/").trim();if(0!=((c?c.length-c.replace(/\*/g,"").length:0)&1))return q(B,c),k(B),g(l("errorInvalidNamingMask")),!1;c.indexOf("*")!=c.lastIndexOf("*")&&t("naming_mask");b=1==b;for(var f=
[],h=a.url.split("\r\n"),m=I(a.referer),n=I(a.desc),p=I(a.text),r=I(a.title),x="on"==a.addtop||"checked"==a.addtop||"yes"==a.addtop,y="",C=0,E=h.length;C<E;++C){var O=I(h[C]).replace(/ /g,"%20");if(O){var da=ca(O);if(da)if(ya(O.replace(/\[[^\[\]]*\]/g,""))){if(!confirm(Y(da))||""!=a.naming&&-1==a.naming.indexOf("*")&&!confirm(l("confirmBatchDownloadNaming")))return!1;J(da,"",0,function(ea){f.push({url:ea,folder:d,naming:c,referer:m,desc:n})});t("batch_desc")}else y+=O+"\n";else ya(O)?f.push({url:O,
folder:d,naming:c,referer:m,desc:n,text:p,title:r}):y+=O+"\n"}}a=!0;if(f&&0<f.length)try{h=!1;try{h="chrome-extension:"==window.top.location.protocol}catch(ea){}chrome.runtime.sendMessage({cmd:"new_task",add_paused:b,addtop:x,tasks:f,page_title:ka,source:"dialog_"+(h?"chrono":"others")},function(ea){ea||g(chrome.runtime.lastError)})}catch(ea){g(ea+(Ja?"\n"+Ja:""),-1),a=!1}else a=!1;if(y||0==f.length)a=!1,y=I(y),0<y.length&&q(z,y),k(z),g(l("errorInvalidURLs"));return a}function K(b,a){var d=Ca(b,30);
{var c=d!=b?L(b):"";d=L(d);const f=document.createElement("li");f.setAttribute("data-value",b);c&&f.setAttribute("title",c);a?f.className="mdc-list-item mdc-list-item--disabled folder-na":(f.setAttribute("tabindex","0"),f.className="mdc-list-item");b=document.createElement("span");b.className="mdc-list-item__ripple";a=document.createElement("span");a.className="mdc-list-item__text";a.textContent=d;f.appendChild(b);f.appendChild(a);d=f}return d}function G(b){if(b){var a=z.val();a?q(z,a+"\n"+b):q(z,
b);Z(z[0])}}function M(b,a){b||(b={url:"",referer:"",desc:""});a&&a.fontSize&&(document.documentElement.style.fontSize=a.fontSize+"px");if("<clipboard>"==b.url)g(l("statusReadClipboard"),-1),setTimeout(function(){var c=$("<textarea/>");c.appendTo($("body")).focus();document.execCommand("paste");var f=c.val();c.remove();c=f.trim().replace(/ /g,"%20");b.url=c&&ya(c)?c:"";g();M(b,a)},100);else{var d=z.val();G(b.url);if(!d){q(v.find("[name=referer]"),b.referer);q(v.find("[name=desc]"),b.desc);q(v.find("[name=addtop]"),
!1,"checked");(d=a?a.taskDef:null)&&d.addtop&&q(v.find("[name=addtop]"),!0,"checked");b.text&&v.find("[name=text]").val(b.text);b.title&&v.find("[name=title]").val(b.title);const c=document.getElementById("filedlg-toggler");c.disabled=!0;Da("naming_history","naming_list");Da("folder-select-list","path_list_recents",{process:f=>{f=za(f);return K(f,!0)},j:f=>{U||chrome.runtime.sendMessage({cmd:"browser_home_path_normalized"},function(h){h?(f.querySelectorAll(".mdc-list-item").forEach(m=>{m.getAttribute("data-value").startsWith(h)&&
(m.classList.remove("folder-na","mdc-list-item--disabled"),m.setAttribute("tabindex","0"))}),a&&a.useLastLocation&&P.R()||P.B(h),a.canFileAccess?(V.m(),c.classList.remove("disable-filedlg")):c.classList.add("disable-filedlg"),c.disabled=!1,document.getElementById("folder-row").style.display="",V.s(h)):(document.getElementById("folder-row").style.display="none",g(l("msgFolderDisabledNonWritable"),-1,{text:l("tipBtnChangeDefaultLocation"),action:ua.bind(void 0,"errNoHome")}),ia(),U=!0)})}})}v.removeClass("transparent");
b&&b.url?B.focus():z.focus()}}function H(){Array.from(v[0].getElementsByClassName("mdc-text-field")).forEach(b=>{b=[b];q(b,"");q(b,!0,"valid")});P.J().selectedIndex=-1}function N(){v.removeClass("filedlg-expanded");v.addClass("transparent");H();Z(z[0]);V.reset();setTimeout(function(){window.parent.postMessage({cmd:"close_dlg",id:oa},"*")},400)}function Y(b){var a=l("confirmBatchDownload")+"\n",d="",c=3,f=2,h=c+f+1;J(b,"",0,function(E){0<c--&&(d+=E+"\n");return 0<--h});if(h-1<f){var m="";f-=Math.max(h-
1,0);var n={a:[]};n.c=b.c;for(var p=0;p<b.a.length;++p){var r=b.a[p].from,x=b.a[p].b,y=b.a[p].step,C=r;if(0<y)for(;C<=x;C+=y);else for(;C>=x;C+=y);C-=y;n.a.push({from:C,b:r,step:-y,g:b.a[p].g,padding:b.a[p].padding,i:b.a[p].i})}J(n,"",0,function(E){m=E+"\n"+m;return 0<--f});0>=h&&(d+="...\n");d+=m}b.stop=!1;return a=a+d+("\n"+l("confirmProceed"))}function J(b,a,d,c){if(b&&!b.stop)if(d<b.c.length&&(a+=b.c[d]),d>=b.c.length-1)0==c(a)&&(b.stop=!0);else{var f=b.a[d];if(0<f.step)if(f.g)for(var h=f.from;h<=
f.b;h+=f.step)J(b,a+String.fromCharCode(h),d+1,c);else if(f.padding)for(h=f.from;h<=f.b;h+=f.step){var m=Math.abs(h).toString();J(b,a+(0>h?"-":"")+(f.i+m).slice(-Math.max(f.padding,m.length)),d+1,c)}else for(h=f.from;h<=f.b;h+=f.step)J(b,a+h,d+1,c);else if(f.g)for(h=f.from;h>=f.b;h+=f.step)J(b,a+String.fromCharCode(h),d+1,c);else if(f.padding)for(h=f.from;h>=f.b;h+=f.step)m=Math.abs(h).toString(),J(b,a+(0>h?"-":"")+(f.i+m).slice(-Math.max(f.padding,m.length)),d+1,c);else for(h=f.from;h>=f.b;h+=f.step)J(b,
a+h,d+1,c)}}function ca(b){function a(c){return"0"==c[0]&&1<c.length||"-"==c[0]&&"0"==c[1]&&2<c.length}if(-1!=b.indexOf("\x00\x00"))return null;var d={c:[],a:[],stop:!1};b=b.replace(/\[((?:-)?\d+|[a-z]):((?:-)?\d+|[a-z])(?::((?:-)?\d+))?\]/gi,function(c,f,h,m){var n=0;if(void 0!=m&&(n=parseInt(m),isNaN(n)||!isFinite(n)))return c;m=f.charCodeAt(0);var p=h.charCodeAt(0);if(65<=m&&90>=m&&65<=p&&90>=p||97<=m&&122>=m&&97<=p&&122>=p){if(n=n||(0>p-m?-1:1),p==m||0>p-m==0>n)return d.a.push({g:!0,from:m,b:p,
step:n}),"\x00\x00"}else{m=parseInt(f,10);p=parseInt(h,10);if(isNaN(m)||isNaN(p))return c;n=n||(0>p-m?-1:1);if(p==m||0>p-m==0>n){c={g:!1,from:m,b:p,step:n};a(f)?(f=f.length-("-"==f[0]),a(h)?c.padding=Math.max(f,h.length-("-"==h[0])):c.padding=f):a(h)&&(c.padding=h.length-("-"==h[0]));if(c.padding)for(c.i=Array(c.padding+1).join("0"),c.A=1,h=0;h<c.padding;++h)c.A*=10;d.a.push(c);return"\x00\x00"}}return c});return d.a.length?(d.c=b.split("\x00\x00"),d):null}function fa(b,a,d){g(l("errorUnableOpen",
L(Ca(b,60)))+" "+l("msgChooseFolderUnderHome"),7E3,{text:l("tipBtnChangeDefaultLocation"),action:ua.bind(void 0,"errNotUnderHome")},a);t("fdlg_err_outside_home",d)}function Z(b){let a=((b.value||"").match(la)||[]).length+1;4<a&&(a=4);b.setAttribute("rows",a);b.parentElement.classList.toggle("multi-rows",1<a)}let U=!1;$.fn.N=function(){var b={};$.each(this.serializeArray(),function(){void 0!==b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=
this.value||""});return b};var oa=e("id"),ka=decodeURIComponent((e("page_title")||"").replace(/\+/g," "));let S=e("fs");S&&(document.documentElement.style.fontSize=S+"px");let v,z,B,P,ja;document.addEventListener("DOMContentLoaded",function(){Ka();v=$(".overlay");z=v.find("[name=url]");B=v.find("[name=naming]");ja=v.find("[name=folder]");P=new u(v.find("#folder-select")[0]);document.getElementById("folder-select-list").addEventListener("click",b=>{b=b.target.closest(".folder-na");t("fdlg_folder_list");
b&&(b=b.getAttribute("data-value"),fa(b,!0,"list"))});Fa();B.attr("placeholder",l("phraseAutomatic"));z.on("input",function(b,a){function d(...h){let m=Date.now(),n=c+a;m<n?f||(f=setTimeout(function(){f=void 0;d(...h)},n-m)):(c=m,b(...h))}let c=0,f;return d}(Z.bind(this,z[0]),200));$(document).bind("keydown.dydlg",function(b){switch(b.keyCode){case 27:b.target==document.body&&(D&&D.V&&D.closeOnEscape?D.close():v.hasClass("filedlg-expanded")?V.close():N());break;case 70:case 71:case 79:case 83:if(b.ctrlKey||
b.metaKey)return!1}});Ea(v.find("input, textarea, button"));v.find(".close-button").click(function(){N()});v.find(".dlg_start_btn").click(w);La(document.getElementById("menu-add-paused"),document.getElementById("btnMenuAddPaused"),function(b){0==b.detail.index&&w(!0)});v.find("#btnSystemFileDlg").click(function(){let b=(z[0].value||"").trim();0<(b.match(la)||[]).length||ca(b)?(k(z),g(l("errorSingleURLAllowed"))):ya(b)?(t("fdlg_use_system"),chrome.runtime.sendMessage({cmd:"save_as",url:b}),N()):(k(z),
g(l("errorInvalidURLs")))});v.find("#tip-batch_desc").click(function(){chrome.runtime.sendMessage({cmd:"open_options",section:"help.batch_desc"})});v.find("#tip-naming_mask").click(function(){chrome.runtime.sendMessage({cmd:"open_options",section:"help.naming_mask"})});document.getElementById("filedlg-toggler").addEventListener("click",function(b){b.target.classList.contains("disable-filedlg")?g(l("msgFolderDisabledNoFileAccess")+" "+l("msgEnableFileAccess",["`"+l("chromesysAllowFileAccess")+"`",
"`"+l("extName")+"`"]),-1,{text:l("btnGrantPermission"),action:va}):(b=P.K(),v.addClass("ever-expanded"),V.open(b))});V.G(b=>{ja.val(b);console.log("folder=>: "+b)});V.P(b=>{P.B(b)})});let X={},D,R;const la=/\r\n|\r|\n/g;return{m:M,H:G,D:function(b){v.toggleClass("filedlg-expanded",b)},h:g,C:fa,O:q}})();window.addEventListener("message",function(e){if("init"==e.data.cmd)try{Ja=l("errorUnknownReloadPage"),W.m(e.data.task,e.data.dlg_opts)}catch(g){W.h(g+(Ja?"\n"+Ja:""),-1)}},!1);
window.addEventListener("dragover",function(e){var g=e.target.nodeName.toLowerCase();("input"!=g&&"textarea"!=g||e.target.disabled)&&e.preventDefault()},!1);window.addEventListener("drop",function(e){var g=e.target.nodeName.toLowerCase();if("input"!=g&&"textarea"!=g||e.target.disabled)g=e.dataTransfer.getData("text/plain").replace(/ /g,"%20"),ya(g)&&(W.H(g),e.preventDefault())},!1);let V=(()=>{function e(a,d){let c=d.f;if("-1"==a.f)return"-1"==c?0:-1;if("-1"==c)return 1;a=S.cmp(a,d);return v?a:-a}async function g(a,d,c){a=za(a);if(a!=H){var f=a.startsWith(H)?a.substr(H.length):a;if(f==a)console.error("path to create is not under HOME path");else{a=za(Aa(H,f.replace(/~|\*|\?|:|\||<|>|"/g,"_")));var h=[a,""];for(f={};h[0]&&h[0].length>=H.length;){var m=[];f[h[0]]=m;h[1]&&m.push(h[1]);if((d||h[0].length<a.length)&&(m=await A(h[0],!0))&&Array.isArray(m.list)){let n;if(h[1]&&(n=
m.list.find(p=>{var r=h[1];return p.url==r||p.name.toLocaleLowerCase()==r.toLocaleLowerCase()}))){W.h(l("errorFileOrFolderExists")+"\n"+L(Aa(h[0],n.name)));return}break}if(Array.isArray(z[h[0].toLocaleLowerCase()]))break;h=Ba(h[0])}if(h[0].length==a.length)W.h(l("errorFileOrFolderExists"));else{for(const n in f)(d=z[n.toLocaleLowerCase()])?Array.prototype.push.apply(d,f[n]):z[n.toLocaleLowerCase()]=f[n];G(a);t("new_dir",c)}}}}function k(a){var d=!a.startsWith(H);const c=document.createElement("li");
c.setAttribute("path",a);c.setAttribute("title",L(a));d?c.className="mdc-list-item mdc-list-item--disabled folder-na":(c.setAttribute("tabindex","0"),c.className="mdc-list-item");d=document.createElement("span");d.className="mdc-list-item__ripple";const f=document.createElement("span");f.className="mdc-list-item__text";{var h=0;"/"==a[a.length-1]&&(h=1);h=a.length-h;const m=a.lastIndexOf("/",h-1)+1;a=h<=m?"":a.substring(m,h)}f.textContent=a||"/";c.appendChild(d);c.appendChild(f);return c}function q(){if(D){try{b&&
b(B.current())}catch(a){console.error(a)}W.D(!1);B.reset()}}function u(){let a={process:d=>k(za(d)),j:d=>{0==d.getElementsByTagName("li").length&&(d.parentElement.style.display="none")}};Da("nav-folders-recents-list","path_list_recents",a);Da("nav-folders-favs-list","path_list_favs",a)}function w(){function a(){if(p)return p;let r=document.getElementById("new-folder-dialog");p=Ma(r);let x=r.querySelector("[name=new-dir-input]"),y=r.querySelector("button:last-child");x.addEventListener("input",()=>
{y.disabled=!(x.value||"").trim()});r.addEventListener("MDCDialog:closed",function(C){"accept"==C.detail.action&&g(Aa(B.current(),x.value),!0,"dlg");W.O([x],"")});return p}N=document.getElementById("btn-back");Y=document.getElementById("btn-forward");J=document.getElementById("btn-up");ca=document.getElementById("btn-view");fa=document.getElementById("btn-sort");Z=document.getElementById("btn-new-folder");let d=document.getElementById("main"),c=document.getElementById("nav-folders");const f=["view-details",
"view-icons"];let h=0;d.classList.add(f[h]);ca.addEventListener("click",()=>{d.getElementsByTagName("li").length&&(d.classList.remove(f[h]),h=(h+1)%f.length,d.classList.add(f[h]))});d.addEventListener("click",r=>{let x;r.target&&(x=r.target.closest(".dir-item"))&&(r=x.getElementsByClassName("dir-item-name")[0].innerText,M(Aa(B.current(),r)))});const m=document.getElementById("nav-folders-recents-header");m.addEventListener("click",()=>{m.parentElement.classList.toggle("nav-folders-hidden")});const n=
document.getElementById("nav-folders-favs-header");n.addEventListener("click",()=>{n.parentElement.classList.toggle("nav-folders-hidden")});c.addEventListener("click",r=>{let x;r.target&&(x=r.target.closest(".mdc-list-item"))&&(r=x.getAttribute("path"),x.classList.contains("folder-na")?W.C(r,!1,"nav"):M(r),t("fdlg_navlst","nav-folders-favs-list"==x.parentElement.id?"fav":"rec"))});J.addEventListener("click",()=>{const r=B.current();r!=H&&(M(r.replace(/[\/\\][^\/\\:]+[\/\\]?$/,"")),t("fdlg_abar","nav"))});
N.addEventListener("click",()=>{B.back();t("fdlg_abar","nav")});Y.addEventListener("click",()=>{B.forward();t("fdlg_abar","nav")});document.getElementById("btn-close-filedlg").addEventListener("click",q);let p;Z.addEventListener("click",()=>{a().open()});La(document.getElementById("menu-downloads-folder"),document.getElementById("button-home-dropdown"),function(r){0==r.detail.index?chrome.downloads.showDefaultFolder():1==r.detail.index&&ua("fdlg")});La(document.getElementById("menu-sort"),fa,function(r){0==
r.detail.index?S!==oa?(S=oa,v=!0):v=!v:1==r.detail.index&&(S!==ka?(S=ka,v=!1):v=!v);K()});P=ja(document.getElementById("path-widget"))}function A(a,d){return X("file:///"+a).then(c=>{let f=[];if("timeout"==c||"other_error"==c)return{error:c};if("not_found"!=c)for(var h=/<script>addRow\((.*?)\);<\/script>/g,m;m=h.exec(c);){var n=m[1].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);m=n[0].replace(/"/g,"");let p=n[1].replace(/"/g,""),r=n[2],x=n[5];n=n[6].replace(/"/g,"");(d&&"1"!=r||!d&&"1"==r)&&f.push({name:m,
url:p,v:n,f:x})}if(d)return"not_found"==c?null:{list:f};h=z[a.toLocaleLowerCase()];if(!Array.isArray(h))return"not_found"==c?null:{list:f};for(const p of h)f.some(r=>r.name==p)||f.push({name:p,url:encodeURIComponent(p),v:"-",f:"-1"});return{list:f}}).catch(()=>null)}function K(){R=R||[];R.sort(e);var a=document.getElementById("menu-sort");let d=a.querySelector(".sorted-up,.sorted-down");null!=d&&d.classList.remove("sorted-up","sorted-down");a.querySelector(`.sort-row-wrap[data-sortcol=${S.u}]`).classList.add(`sorted-${v?
"up":"down"}`);for(a=document.getElementById("main");a.lastElementChild;)a.removeChild(a.lastElementChild);const c=document.createElement("ul");R.forEach(f=>{const h=document.createElement("li");h.setAttribute("href",f.url);h.className="dir-item";const m=document.createElement("span");m.className="-1"==f.f?"dir-icon material-icons dir-icon-new":"dir-icon material-icons";const n=document.createElement("span");n.className="dir-item-name";n.textContent=f.name;const p=document.createElement("span");p.className=
"dir-item-time";p.textContent=f.v;h.appendChild(m);h.appendChild(n);h.appendChild(p);c.appendChild(h)});a.appendChild(c)}async function G(a,d){a=a||H;if(a==B.I())return 0;var c=a.startsWith(H)?a.substr(H.length):a;if(c==a)return-2;let f=await A(a);if(null==f)return-1;if(f.error||!f.list)return-3;0!=d&&B.push(a);P.set(c);J.disabled=!c;N.disabled=!B.L();Y.disabled=!B.M();fa.disabled=ca.disabled=0==f.list.length;Z.disabled=!1;d=U._mdc_obj_;a:{c=a;var h=document.getElementById("nav-folders-favs-list");
for(h=h.firstElementChild;h;h=h.nextElementSibling)if(h.getAttribute("path")==c){c=!0;break a}c=!1}d.on=c;R=f.list;K();for(const m of la)m(a);return 1}async function M(a,d){a=za(a);d=await G(a,d);switch(d){case -1:W.h(l("confirmCreateWhenNotExists","`"+L(Ca(a,60)+"`")),1E4,{text:l("btnCreate"),action:g.bind(V,a,!1,"lsd")});break;case -2:W.C(a);break;case -3:W.h(l("errorUnableOpen",L(Ca(a,60))),4E3)}return d}let H,N,Y,J,ca,fa,Z,U;const oa={u:"name",cmp:(a,d)=>a.name.localeCompare(d.name)},ka={u:"time",
cmp:(a,d)=>a.f.localeCompare(d.f)};let S=ka,v=!1,z={},B=(()=>{function a(){return c<d.length-1}let d=[],c=-1;return{empty:function(){return 0==d.length},push:function(f){for(;d.length-1>c;)d.pop();d.push(f);++c},back:async function(){0<c&&0<=await M(d[c-1],!1)&&(--c,N.disabled=!(0<c),Y.disabled=!a())},forward:async function(){a()&&0<=await M(d[c+1],!1)&&(++c,N.disabled=!(0<c),Y.disabled=!a())},L:function(){return 0<c},M:a,current:function(){if(0<=c&&c<d.length)return d[c];throw"empty path stack";
},I:function(){return 0<=c&&c<d.length?d[c]:""},reset:function(){d=[];c=-1}}})(),P,ja=a=>{function d(n){n?a.classList.add("focused"):a.classList.remove("focused")}let c=a.getElementsByClassName("button-home")[0],f=a.getElementsByClassName("path-home")[0],h=a.getElementsByClassName("buttons-view")[0],m=a.getElementsByClassName("input-view-input")[0];U=a.getElementsByClassName("path-fav")[0];U._mdc_obj_=new mdc.iconButton.MDCIconButtonToggle(U);c.addEventListener("click",()=>{G()});U.addEventListener("MDCIconButtonToggle:change",
function(n){n=n.detail.isOn;const p=B.current();{const r=document.getElementById("nav-folders-favs"),x=document.getElementById("nav-folders-favs-list");let y=0,C=!1;for(let E=x.firstElementChild;E;E=E.nextElementSibling,y++)if(E.getAttribute("path")==p){n?0<y&&(x.removeChild(E),x.prepend(E)):x.removeChild(E);C=!0;break}n&&!C&&x.prepend(k(p));r.style.display=0==x.childElementCount?"none":""}ta({cmd:"fav_path",fav:n,path:p});n&&t("fdlg_abar","fav")});m.addEventListener("blur",()=>{d(!1)});m.addEventListener("keydown",
n=>{13==n.keyCode&&(m.blur(),M(Aa(H,m.value)),t("fdlg_abar","enter"))});a.addEventListener("blur",()=>{d(!1)});a.addEventListener("click",n=>{if(n.target.classList.contains("input-view-trigger"))d(!0),m.focus(),m.select();else if(n=n.composedPath().find(p=>p.classList&&p.classList.contains("path-button"))){let p=n.parentElement;if(p.nextElementSibling){for(n=[];p;)n.unshift(p.lastElementChild),p=p.previousElementSibling;M(Aa(H,n.map(r=>r.innerText).join("/")));t("fdlg_abar","path_btn")}}});return{set:function(n){let p=
n.split(/[\\\/]/).filter(C=>!!C),r=[].slice.call(h.getElementsByClassName("path-button"));for(;r.length>p.length;)r.pop().parentElement.remove();let x=[];for(;r.length<p.length;){var y=document.createElement("div");let C=document.createElement("span"),E=document.createElement("span"),O=document.createElement("span"),da=document.createElement("span");y.className="path-button-wrap";C.className="path-button-sep";E.className="path-button mdc-button";O.className="mdc-button__ripple";da.className="mdc-button__label";
y.appendChild(C);y.appendChild(E);E.append(O);E.append(da);r.push(E);x.push(y)}for(y=0;y<p.length;++y)r[y].lastElementChild.innerText=p[y];for(;0<x.length;)h.appendChild(x.shift());m.value=L(za(n,!1));a.classList.toggle("has-subdirs",0<r.length)},X:d,s:function(n){f.innerText=L(n)}}},X=a=>new Promise(d=>{let c=new XMLHttpRequest;c.timeout=500;c.open("GET",a);c.onloadend=f=>{f.loaded&&c.response?d(c.response):d("not_found")};c.ontimeout=()=>d("timeout");c.send()}),D=!1,R=[],la=[],b;document.addEventListener("DOMContentLoaded",
function(){w()});return{reset:function(){D&&(B.reset(),z={},D=!1)},m:function(){D=!0},open:function(a){if(D){if(!B.empty())throw"non-empty path stack";a&&a!=H?M(a).then(d=>{0>d&&G()}):G();u();W.D(!0);t("fdlg_open")}},close:q,s:function(a){D&&(H=a,P.s(a))},G:a=>{la.push(a)},P:a=>{b=a}}})();function La(e,g,k){const q=new mdc.menu.MDCMenu(e);q.quickOpen=!0;g.addEventListener("click",()=>{(q.open=!q.open)&&q.root.focus()});k&&e.addEventListener("MDCMenu:selected",k)}function Ma(e){e=new mdc.dialog.MDCDialog(e);e.scrimClickAction="";return e}
function Ka(){var e=document.querySelectorAll(".mdc-text-field,.mdc-checkbox");for(var g of e){e=g.classList.contains("mdc-text-field")?new mdc.textField.MDCTextField(g):new mdc.checkbox.MDCCheckbox(g);g._mdc_obj_=e;let k=g.getElementsByTagName("input")[0]||g.getElementsByTagName("textarea")[0];k&&(k._mdc_obj_=e)}g=document.querySelectorAll(".mdc-select");for(const k of g)g=new mdc.select.MDCSelect(k),k._mdc_obj_=g};
